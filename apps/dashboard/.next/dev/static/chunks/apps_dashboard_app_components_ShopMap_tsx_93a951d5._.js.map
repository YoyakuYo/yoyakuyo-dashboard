{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/81704/bookyo/apps/dashboard/app/components/ShopMap.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useEffect, useRef, useState, useMemo } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\n// Fix for default Leaflet marker icon issue\r\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',\r\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',\r\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\r\n});\r\n\r\ninterface ShopMapProps {\r\n  latitude: number;\r\n  longitude: number;\r\n  shopName: string;\r\n  address?: string;\r\n  height?: string;\r\n}\r\n\r\nexport default function ShopMap({ \r\n  latitude, \r\n  longitude, \r\n  shopName, \r\n  address,\r\n  height = '400px' \r\n}: ShopMapProps) {\r\n  // Only render on client side to avoid SSR issues\r\n  const [isClient, setIsClient] = useState(false);\r\n  const [mapReady, setMapReady] = useState(false);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  \r\n  // Generate a unique ID for this component instance that persists across re-renders\r\n  const instanceId = useMemo(() => `map-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`, []);\r\n\r\n  useEffect(() => {\r\n    setIsClient(true);\r\n    \r\n    // Small delay to ensure container is ready and check for existing maps\r\n    const timer = setTimeout(() => {\r\n      if (containerRef.current) {\r\n        // Check if container already has a Leaflet map instance\r\n        const hasExistingMap = (containerRef.current as any)._leaflet_id !== undefined;\r\n        if (!hasExistingMap) {\r\n          setMapReady(true);\r\n        } else {\r\n          // If map exists, clean it up first\r\n          const existingMap = (containerRef.current as any)._leaflet;\r\n          if (existingMap) {\r\n            existingMap.remove();\r\n          }\r\n          // Remove Leaflet data\r\n          delete (containerRef.current as any)._leaflet_id;\r\n          delete (containerRef.current as any)._leaflet;\r\n          setMapReady(true);\r\n        }\r\n      }\r\n    }, 100);\r\n\r\n    return () => {\r\n      clearTimeout(timer);\r\n      // Cleanup on unmount\r\n      if (containerRef.current) {\r\n        const map = (containerRef.current as any)._leaflet;\r\n        if (map && typeof map.remove === 'function') {\r\n          try {\r\n            map.remove();\r\n          } catch (e) {\r\n            // Ignore cleanup errors\r\n          }\r\n        }\r\n        delete (containerRef.current as any)._leaflet_id;\r\n        delete (containerRef.current as any)._leaflet;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  if (!isClient || !mapReady) {\r\n    return (\r\n      <div \r\n        className=\"w-full rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center\"\r\n        style={{ height }}\r\n      >\r\n        <p className=\"text-gray-500\">Loading map...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!latitude || !longitude) {\r\n    return (\r\n      <div \r\n        className=\"w-full rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center\"\r\n        style={{ height }}\r\n      >\r\n        <p className=\"text-gray-500\">Location not available</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div \r\n      ref={containerRef}\r\n      className=\"w-full rounded-xl overflow-hidden shadow-lg\" \r\n      style={{ height }}\r\n      id={instanceId}\r\n    >\r\n      <MapContainer\r\n        key={instanceId}\r\n        center={[latitude, longitude]}\r\n        zoom={15}\r\n        scrollWheelZoom={true}\r\n        style={{ height: '100%', width: '100%' }}\r\n        className=\"z-0\"\r\n      >\r\n        <TileLayer\r\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n          url=\"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png\"\r\n        />\r\n        <Marker position={[latitude, longitude]}>\r\n          <Popup>\r\n            <div className=\"p-2\">\r\n              <h3 className=\"font-bold text-gray-900 mb-1\">{shopName}</h3>\r\n              {address && <p className=\"text-sm text-gray-600\">{address}</p>}\r\n            </div>\r\n          </Popup>\r\n        </Marker>\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}