{"version":3,"sources":["../../../../../../apps/dashboard/app/%28owner%29/assistant/page.tsx"],"sourcesContent":["// apps/dashboard/app/(owner)/assistant/page.tsx\r\n// AI Assistant page for shop owners with customer message threads\r\n\r\n\"use client\";\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { useAuth } from '@/lib/useAuth';\r\nimport { getSupabaseClient } from '@/lib/supabaseClient';\r\nimport { useTranslations } from 'next-intl';\r\n\r\ninterface Thread {\r\n  id: string;\r\n  shopId: string;\r\n  bookingId: string | null;\r\n  customerEmail: string | null;\r\n  unreadCount: number;\r\n  lastMessageAt: string;\r\n  lastMessagePreview: string | null;\r\n  lastMessageFrom: string | null;\r\n  ownerTakenOver?: boolean;\r\n}\r\n\r\ninterface ChatMessage {\r\n  id: string;\r\n  senderType: 'customer' | 'owner' | 'ai';\r\n  content: string;\r\n  createdAt: string;\r\n  readByOwner: boolean;\r\n  readByCustomer: boolean;\r\n  senderId?: string | null;\r\n  originalContent?: string; // Original content before translation (for owner messages)\r\n  translatedContent?: string; // Translated content (for customer/AI messages)\r\n}\r\n\r\nexport default function AssistantPage() {\r\n  const { user } = useAuth();\r\n  const t = useTranslations();\r\n  const [threads, setThreads] = useState<Thread[]>([]);\r\n  const [selectedThreadId, setSelectedThreadId] = useState<string | null>(null);\r\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingThreads, setLoadingThreads] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [ownerTakenOver, setOwnerTakenOver] = useState(false);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const [translatingMessages, setTranslatingMessages] = useState<Set<string>>(new Set());\r\n  const [ownerPreferredLanguage, setOwnerPreferredLanguage] = useState<string>('en');\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const subscriptionRef = useRef<any>(null);\r\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000';\r\n\r\n  // Auto-scroll to bottom when new messages arrive\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  // Load threads and owner preferences on mount\r\n  useEffect(() => {\r\n    if (user?.id) {\r\n      loadThreads();\r\n      loadOwnerPreferences();\r\n    }\r\n  }, [user]);\r\n\r\n  const loadOwnerPreferences = async () => {\r\n    try {\r\n      const res = await fetch(`${apiUrl}/users/me`, {\r\n        headers: {\r\n          'x-user-id': user?.id || '',\r\n        },\r\n      });\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setOwnerPreferredLanguage(data.preferredLanguage || 'en');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading owner preferences:', error);\r\n    }\r\n  };\r\n\r\n  // Load messages when thread is selected\r\n  useEffect(() => {\r\n    if (selectedThreadId) {\r\n      loadMessages(selectedThreadId);\r\n      subscribeToMessages(selectedThreadId);\r\n      markAsRead(selectedThreadId);\r\n    }\r\n\r\n    // Cleanup subscription on thread change\r\n    return () => {\r\n      if (subscriptionRef.current) {\r\n        const supabase = getSupabaseClient();\r\n        supabase.removeChannel(subscriptionRef.current);\r\n      }\r\n    };\r\n  }, [selectedThreadId]);\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (subscriptionRef.current) {\r\n        const supabase = getSupabaseClient();\r\n        supabase.removeChannel(subscriptionRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const loadThreads = async () => {\r\n    try {\r\n      setLoadingThreads(true);\r\n      const res = await fetch(`${apiUrl}/messages/owner/threads`, {\r\n        headers: {\r\n          'x-user-id': user?.id || '',\r\n        },\r\n      });\r\n\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setThreads(Array.isArray(data) ? data : []);\r\n      } else {\r\n        console.error('Failed to load threads');\r\n        setThreads([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading threads:', error);\r\n      setThreads([]);\r\n    } finally {\r\n      setLoadingThreads(false);\r\n    }\r\n  };\r\n\r\n  const loadMessages = async (threadId: string) => {\r\n    try {\r\n      const res = await fetch(`${apiUrl}/messages/thread/${threadId}`);\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        const messagesData = Array.isArray(data) ? data : [];\r\n        \r\n        // Load takeover status\r\n        const thread = threads.find(t => t.id === threadId);\r\n        if (thread) {\r\n          setOwnerTakenOver(thread.ownerTakenOver || false);\r\n        }\r\n        \r\n        // Translate customer/AI messages to owner's preferred language\r\n        const translatedMessages = await Promise.all(\r\n          messagesData.map(async (msg: ChatMessage) => {\r\n            if (msg.senderType === 'owner') {\r\n              // Owner messages: use originalContent if available\r\n              return {\r\n                ...msg,\r\n                originalContent: msg.originalContent || msg.content,\r\n                translatedContent: msg.content, // Owner's message is already in their language\r\n              };\r\n            } else if (msg.senderType === 'customer' || msg.senderType === 'ai') {\r\n              // Detect message language and translate to owner's preferred language if needed\r\n              // Simple heuristic to detect if message is already in owner's language\r\n              const needsTranslation = msg.content && !msg.translatedContent;\r\n              \r\n              if (needsTranslation) {\r\n                try {\r\n                  const translateRes = await fetch(`${apiUrl}/ai/translate`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                      text: msg.content,\r\n                      targetLanguage: ownerPreferredLanguage,\r\n                      sourceLanguage: 'auto', // Auto-detect source language\r\n                    }),\r\n                  });\r\n                  \r\n                  if (translateRes.ok) {\r\n                    const translateData = await translateRes.json();\r\n                    return {\r\n                      ...msg,\r\n                      originalContent: msg.content,\r\n                      translatedContent: translateData.translatedText || msg.content,\r\n                      detectedLanguage: translateData.sourceLanguage,\r\n                    };\r\n                  }\r\n                } catch (translateError) {\r\n                  console.error('Error translating message:', translateError);\r\n                }\r\n              }\r\n              \r\n              return {\r\n                ...msg,\r\n                originalContent: msg.content,\r\n                translatedContent: msg.translatedContent || msg.content,\r\n              };\r\n            }\r\n            return msg;\r\n          })\r\n        );\r\n        \r\n        setMessages(translatedMessages);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading messages:', error);\r\n    }\r\n  };\r\n  \r\n  const toggleTakeover = async () => {\r\n    if (!selectedThreadId) return;\r\n    \r\n    const newTakenOver = !ownerTakenOver;\r\n    setOwnerTakenOver(newTakenOver);\r\n    \r\n    try {\r\n      const res = await fetch(`${apiUrl}/messages/thread/${selectedThreadId}/takeover`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ takenOver: newTakenOver }),\r\n      });\r\n      \r\n      if (!res.ok) {\r\n        // Revert on error\r\n        setOwnerTakenOver(!newTakenOver);\r\n        console.error('Failed to toggle takeover');\r\n      } else {\r\n        // Update thread in list\r\n        setThreads((prev) =>\r\n          prev.map((thread) =>\r\n            thread.id === selectedThreadId\r\n              ? { ...thread, ownerTakenOver: newTakenOver }\r\n              : thread\r\n          )\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Error toggling takeover:', error);\r\n      setOwnerTakenOver(!newTakenOver);\r\n    }\r\n  };\r\n\r\n  const markAsRead = async (threadId: string) => {\r\n    try {\r\n      await fetch(`${apiUrl}/messages/thread/${threadId}/mark-read-owner`, {\r\n        method: 'POST',\r\n      });\r\n      \r\n      // Update local unread count\r\n      setThreads((prev) =>\r\n        prev.map((thread) =>\r\n          thread.id === threadId ? { ...thread, unreadCount: 0 } : thread\r\n        )\r\n      );\r\n    } catch (error) {\r\n      console.error('Error marking as read:', error);\r\n    }\r\n  };\r\n\r\n  const subscribeToMessages = (threadId: string) => {\r\n    const supabase = getSupabaseClient();\r\n    \r\n    const channel = supabase\r\n      .channel(`shop_messages:thread_id=eq.${threadId}`)\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'shop_messages',\r\n          filter: `thread_id=eq.${threadId}`,\r\n        },\r\n        async (payload: any) => {\r\n          const newMessage = payload.new;\r\n          if (newMessage && newMessage.thread_id === threadId) {\r\n            setMessages((prev) => {\r\n              const exists = prev.some((msg) => msg.id === newMessage.id);\r\n              if (exists) return prev;\r\n              \r\n              // Translate customer/AI messages to English for owner\r\n              const messageData: ChatMessage = {\r\n                id: newMessage.id,\r\n                senderType: newMessage.sender_type,\r\n                content: newMessage.content,\r\n                createdAt: newMessage.created_at,\r\n                readByOwner: newMessage.read_by_owner || false,\r\n                readByCustomer: newMessage.read_by_customer || false,\r\n                senderId: newMessage.sender_id || null,\r\n                originalContent: newMessage.content,\r\n                translatedContent: newMessage.content,\r\n              };\r\n              \r\n              // If customer/AI message, translate to owner's preferred language\r\n              if (newMessage.sender_type === 'customer' || newMessage.sender_type === 'ai') {\r\n                // Translate asynchronously\r\n                fetch(`${apiUrl}/ai/translate`, {\r\n                  method: 'POST',\r\n                  headers: { 'Content-Type': 'application/json' },\r\n                  body: JSON.stringify({\r\n                    text: newMessage.content,\r\n                    targetLanguage: ownerPreferredLanguage,\r\n                    sourceLanguage: 'auto', // Auto-detect source language\r\n                  }),\r\n                })\r\n                  .then(res => res.json())\r\n                  .then(data => {\r\n                    setMessages((prev) =>\r\n                      prev.map((msg) =>\r\n                        msg.id === newMessage.id\r\n                          ? { ...msg, translatedContent: data.translatedText || msg.content, detectedLanguage: data.sourceLanguage }\r\n                          : msg\r\n                      )\r\n                    );\r\n                  })\r\n                  .catch(err => console.error('Error translating new message:', err));\r\n              }\r\n              \r\n              return [...prev, messageData];\r\n            });\r\n\r\n            // Update thread last message\r\n            setThreads((prev) =>\r\n              prev.map((thread) =>\r\n                thread.id === threadId\r\n                  ? {\r\n                      ...thread,\r\n                      lastMessageAt: newMessage.created_at,\r\n                      lastMessagePreview: newMessage.content?.substring(0, 100) || null,\r\n                      lastMessageFrom: newMessage.sender_type,\r\n                      unreadCount:\r\n                        newMessage.sender_type === 'customer' && !newMessage.read_by_owner\r\n                          ? thread.unreadCount + 1\r\n                          : thread.unreadCount,\r\n                    }\r\n                  : thread\r\n              )\r\n            );\r\n          }\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    subscriptionRef.current = channel;\r\n  };\r\n\r\n  // Handle typing indicator\r\n  useEffect(() => {\r\n    if (input.trim() && selectedThreadId) {\r\n      setIsTyping(true);\r\n      \r\n      // Clear existing timeout\r\n      if (typingTimeoutRef.current) {\r\n        clearTimeout(typingTimeoutRef.current);\r\n      }\r\n      \r\n      // Set timeout to hide typing indicator after 2 seconds of no typing\r\n      typingTimeoutRef.current = setTimeout(() => {\r\n        setIsTyping(false);\r\n      }, 2000);\r\n    } else {\r\n      setIsTyping(false);\r\n    }\r\n    \r\n    return () => {\r\n      if (typingTimeoutRef.current) {\r\n        clearTimeout(typingTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [input, selectedThreadId]);\r\n\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!input.trim() || loading || !selectedThreadId) {\r\n      return;\r\n    }\r\n\r\n    setIsTyping(false);\r\n    const messageContent = input.trim();\r\n    setInput('');\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const res = await fetch(`${apiUrl}/messages/thread/${selectedThreadId}/send`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          senderType: 'owner',\r\n          senderId: user?.id || null,\r\n          content: messageContent,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const errorData = await res.json().catch(() => ({ error: 'Failed to send message' }));\r\n        throw new Error(errorData.error || `HTTP error! status: ${res.status}`);\r\n      }\r\n\r\n      const sentMessage = await res.json();\r\n      \r\n      // Add message to local state (realtime will also add it, but this is immediate)\r\n      setMessages((prev) => {\r\n        const exists = prev.some((msg) => msg.id === sentMessage.id);\r\n        if (exists) return prev;\r\n        return [...prev, sentMessage];\r\n      });\r\n\r\n      // Update thread last message\r\n      setThreads((prev) =>\r\n        prev.map((thread) =>\r\n          thread.id === selectedThreadId\r\n            ? {\r\n                ...thread,\r\n                lastMessageAt: sentMessage.createdAt,\r\n                lastMessagePreview: sentMessage.content?.substring(0, 100) || null,\r\n                lastMessageFrom: 'owner',\r\n              }\r\n            : thread\r\n        )\r\n      );\r\n\r\n      // Trigger AI response for owner messages (calendar commands, etc.)\r\n      // Get shop ID from thread\r\n      const currentThread = threads.find(t => t.id === selectedThreadId);\r\n      if (currentThread?.shopId) {\r\n        try {\r\n          await fetch(`${apiUrl}/ai/chat-thread`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              threadId: selectedThreadId,\r\n              shopId: currentThread.shopId,\r\n              message: messageContent,\r\n              source: 'owner',\r\n            }),\r\n          });\r\n        } catch (aiError) {\r\n          // Silently handle AI errors - not critical for message sending\r\n          console.error('Error triggering AI response:', aiError);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error sending message:', err);\r\n      setError(err instanceof Error ? err.message : 'Failed to send message');\r\n    } finally {\r\n      setLoading(false);\r\n      // Keep input focused after sending\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 100);\r\n    }\r\n  };\r\n\r\n  const formatTime = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return new Intl.DateTimeFormat('en-US', {\r\n      hour: 'numeric',\r\n      minute: '2-digit',\r\n    }).format(date);\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return new Intl.DateTimeFormat('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: 'numeric',\r\n      minute: '2-digit',\r\n    }).format(date);\r\n  };\r\n\r\n  const selectedThread = threads.find((t) => t.id === selectedThreadId);\r\n\r\n  return (\r\n    <div className=\"p-8 bg-gray-50 min-h-screen\">\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">{t('assistant.title')}</h1>\r\n        <p className=\"text-gray-600\">{t('assistant.subtitle')}</p>\r\n      </div>\r\n\r\n      <div className=\"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden\">\r\n        <div className=\"flex h-[calc(100vh-280px)] min-h-[600px]\">\r\n          {/* Left: Thread List */}\r\n          <div className=\"w-80 border-r border-gray-200 flex flex-col bg-gray-50\">\r\n            <div className=\"px-6 py-4 border-b border-gray-200 bg-white\">\r\n              <h2 className=\"text-lg font-semibold text-gray-800\">{t('assistant.customerConversations')}</h2>\r\n            </div>\r\n            \r\n            <div className=\"flex-1 overflow-y-auto bg-white\">\r\n              {loadingThreads ? (\r\n                <div className=\"p-6 text-center text-gray-500\">{t('assistant.loadingThreads')}</div>\r\n              ) : threads.length === 0 ? (\r\n                <div className=\"p-6 text-center text-gray-500\">\r\n                  <p>{t('assistant.noConversations')}</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"divide-y divide-gray-100\">\r\n                  {threads.map((thread) => (\r\n                    <button\r\n                      key={thread.id}\r\n                      onClick={() => setSelectedThreadId(thread.id)}\r\n                      className={`w-full text-left px-4 py-3 hover:bg-blue-50 transition-colors ${\r\n                        selectedThreadId === thread.id ? 'bg-blue-50 border-l-4 border-blue-600' : ''\r\n                      }`}\r\n                    >\r\n                      <div className=\"flex items-start gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0\">\r\n                          <span className=\"text-lg\">ðŸ‘¤</span>\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-center justify-between mb-1\">\r\n                            <p className=\"text-sm font-semibold text-gray-900 truncate\">\r\n                              {thread.customerEmail || `Thread ${thread.id.substring(0, 8)}`}\r\n                            </p>\r\n                            {thread.unreadCount > 0 && (\r\n                              <span className=\"ml-2 flex-shrink-0 bg-blue-600 text-white text-xs font-semibold rounded-full px-2 py-0.5 min-w-[20px] text-center\">\r\n                                {thread.unreadCount}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          {thread.lastMessagePreview && (\r\n                            <p className=\"text-xs text-gray-500 truncate mb-1\">\r\n                              {thread.lastMessagePreview}\r\n                            </p>\r\n                          )}\r\n                          <p className=\"text-xs text-gray-400\">\r\n                            {formatDate(thread.lastMessageAt)}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Right: Messages */}\r\n          <div className=\"flex-1 flex flex-col bg-gray-50\">\r\n            {selectedThreadId ? (\r\n              <>\r\n                <div className=\"px-6 py-4 border-b border-gray-200 bg-white flex items-center justify-between shadow-sm\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center\">\r\n                      <span className=\"text-lg\">ðŸ‘¤</span>\r\n                    </div>\r\n                    <div>\r\n                      <h2 className=\"text-lg font-semibold text-gray-800\">\r\n                        {selectedThread?.customerEmail || `Thread ${selectedThreadId.substring(0, 8)}`}\r\n                      </h2>\r\n                      {selectedThread?.bookingId && (\r\n                        <p className=\"text-sm text-gray-500\">{t('assistant.booking')} {selectedThread.bookingId.substring(0, 8)}</p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={toggleTakeover}\r\n                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${\r\n                      ownerTakenOver\r\n                        ? 'bg-green-600 text-white hover:bg-green-700'\r\n                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n                    }`}\r\n                  >\r\n                    {ownerTakenOver ? t('assistant.youAreHandling') : t('assistant.letAiHandle')}\r\n                  </button>\r\n                </div>\r\n                \r\n                <div className=\"flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50\">\r\n                  {messages.length === 0 ? (\r\n                    <div className=\"flex items-center justify-center h-full\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-6xl mb-4\">ðŸ’¬</div>\r\n                        <h3 className=\"text-xl font-semibold text-gray-800 mb-2\">{t('assistant.noMessages')}</h3>\r\n                        <p className=\"text-gray-600\">{t('assistant.startConversation')}</p>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      {messages.map((message) => (\r\n                        <div\r\n                          key={message.id}\r\n                          className={`flex gap-3 ${\r\n                            message.senderType === 'owner' ? 'justify-end' : 'justify-start'\r\n                          }`}\r\n                        >\r\n                          {message.senderType !== 'owner' && (\r\n                            <div className=\"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0\">\r\n                              <span className=\"text-lg\">\r\n                                {message.senderType === 'ai' ? 'ðŸ¤–' : 'ðŸ‘¤'}\r\n                              </span>\r\n                            </div>\r\n                          )}\r\n                          <div\r\n                            className={`max-w-[75%] rounded-lg px-4 py-3 shadow-sm ${\r\n                              message.senderType === 'owner'\r\n                                ? 'bg-blue-600 text-white'\r\n                                : 'bg-white text-gray-800 border border-gray-200'\r\n                            }`}\r\n                          >\r\n                            <p className=\"whitespace-pre-wrap break-words\">\r\n                              {message.senderType === 'owner' \r\n                                ? (message.originalContent || message.content)\r\n                                : (message.translatedContent || message.content)\r\n                              }\r\n                            </p>\r\n                            {(message.senderType === 'customer' || message.senderType === 'ai') && \r\n                             message.originalContent && \r\n                             message.originalContent !== message.translatedContent && (\r\n                              <p className=\"text-xs mt-1 opacity-75 italic\">\r\n                                ðŸ‡¯ðŸ‡µ {message.originalContent.substring(0, 50)}\r\n                                {message.originalContent.length > 50 ? '...' : ''}\r\n                              </p>\r\n                            )}\r\n                            <p\r\n                              className={`text-xs mt-2 ${\r\n                                message.senderType === 'owner' ? 'text-blue-100' : 'text-gray-500'\r\n                              }`}\r\n                            >\r\n                              {formatTime(message.createdAt)}\r\n                            </p>\r\n                          </div>\r\n                          {message.senderType === 'owner' && (\r\n                            <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0\">\r\n                              <span className=\"text-sm font-semibold text-gray-600\">You</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                      {isTyping && (\r\n                        <div className=\"flex gap-3 justify-end\">\r\n                          <div className=\"bg-gray-100 rounded-lg px-4 py-3\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\r\n                              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\r\n                              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.4s' }}></div>\r\n                              <span className=\"text-xs text-gray-500 ml-2\">{t('assistant.youAreTyping')}</span>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0\">\r\n                            <span className=\"text-sm font-semibold text-gray-600\">You</span>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                      {loading && (\r\n                        <div className=\"flex gap-3 justify-start\">\r\n                          <div className=\"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0\">\r\n                            <span className=\"text-lg\">ðŸ¤–</span>\r\n                          </div>\r\n                          <div className=\"bg-gray-100 rounded-lg px-4 py-3\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\r\n                              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\r\n                              <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.4s' }}></div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                      <div ref={messagesEndRef} />\r\n                    </>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"px-6 py-4 border-t border-gray-200 bg-white sticky bottom-0\">\r\n                  {error && (\r\n                    <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm\">\r\n                      {error}\r\n                    </div>\r\n                  )}\r\n                  <form onSubmit={handleSubmit} className=\"flex gap-2\">\r\n                    <input\r\n                      ref={inputRef}\r\n                      type=\"text\"\r\n                      value={input}\r\n                      onChange={(e) => setInput(e.target.value)}\r\n                      placeholder={t('assistant.typeMessage')}\r\n                      className=\"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                      disabled={loading}\r\n                      autoFocus\r\n                    />\r\n                    <button\r\n                      type=\"submit\"\r\n                      disabled={!input.trim() || loading}\r\n                      className=\"px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                    >\r\n                      {loading ? t('assistant.sending') : t('assistant.send')}\r\n                    </button>\r\n                  </form>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <div className=\"flex items-center justify-center h-full bg-gray-50\">\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-6xl mb-4\">ðŸ’¬</div>\r\n                  <h3 className=\"text-xl font-semibold text-gray-800 mb-2\">{t('assistant.selectConversation')}</h3>\r\n                  <p className=\"text-gray-600\">{t('assistant.selectConversationDesc')}</p>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}