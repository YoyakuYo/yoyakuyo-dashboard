{"version":3,"sources":["../../../../../../apps/dashboard/app/components/DashboardLayout.tsx","../../../../../../apps/dashboard/app/components/PublicLayoutWrapper.tsx","../../../../../../apps/dashboard/app/components/OwnerPowerBot.tsx","../../../../../../apps/dashboard/lib/useBookingNotifications.ts","../../../../../../node_modules/next-intl/dist/esm/production/shared/NextIntlClientProvider.js","../../../../../../apps/dashboard/app/components/NextIntlProvider.tsx"],"sourcesContent":["// apps/dashboard/app/components/DashboardLayout.tsx\r\n// Applies dashboard layout (Header, Sidebar, AuthGuard) only to non-auth routes\r\n// Auth routes are handled by (auth)/layout.tsx and render without dashboard UI\r\n\r\n\"use client\";\r\n\r\nimport React, { useMemo } from \"react\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport AuthGuard from \"./AuthGuard\";\r\nimport Header from \"./Header\";\r\nimport Sidebar from \"./Sidebar\";\r\nimport PublicLayoutWrapper from \"./PublicLayoutWrapper\";\r\nimport OwnerPowerBot from \"./OwnerPowerBot\";\r\nimport { useBookingNotificationsHook } from \"@/lib/useBookingNotifications\";\r\n\r\n// Routes that should NOT have dashboard layout (Header, Sidebar, AuthGuard)\r\nconst authRoutes: string[] = [];\r\n\r\nexport default function DashboardLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  const pathname = usePathname();\r\n  \r\n  // Route matching rules:\r\n  // DashboardLayout should ONLY apply to routes in the (owner) folder\r\n  // All other routes are public and use (public)/layout.tsx\r\n  const isOwnerRoute = useMemo(() => {\r\n    const route = pathname || \"\";\r\n    \r\n    // Owner dashboard routes (protected, should use DashboardLayout)\r\n    const ownerRoutes = [\r\n      '/shops', // Owner dashboard (not /shops/[id] which is public)\r\n      '/assistant',\r\n      '/bookings',\r\n      '/settings',\r\n    ];\r\n    \r\n    // Check exact matches\r\n    if (ownerRoutes.includes(route)) {\r\n      return true;\r\n    }\r\n    \r\n    // Check if it starts with owner route patterns\r\n    if (route.startsWith('/shops/services')) {\r\n      return true;\r\n    }\r\n    \r\n    // Everything else is public (uses (public)/layout.tsx)\r\n    return false;\r\n  }, [pathname]);\r\n  \r\n  const isAuthRoute = useMemo(() => authRoutes.includes(pathname || \"\"), [pathname]);\r\n  \r\n  console.log(\"üî• DashboardLayout evaluating route:\", pathname, \"| isOwnerRoute:\", isOwnerRoute, \"| isAuthRoute:\", isAuthRoute);\r\n\r\n  // For auth routes, just pass through - login and signup handle their own styling\r\n  if (isAuthRoute) {\r\n    return <>{children}</>;\r\n  }\r\n\r\n  // For public routes, wrap with PublicLayoutWrapper (includes header)\r\n  if (!isOwnerRoute) {\r\n    console.log(\"üî• DashboardLayout: Applying PublicLayoutWrapper for public route:\", pathname);\r\n    return <PublicLayoutWrapper>{children}</PublicLayoutWrapper>;\r\n  }\r\n\r\n  // For owner dashboard routes, apply full dashboard layout with AuthGuard\r\n  return (\r\n    <AuthGuard>\r\n      <BookingNotificationsWrapper>\r\n        <Header />\r\n        <Sidebar />\r\n        <main className=\"lg:ml-64 pt-16 min-h-screen bg-gray-50\">\r\n          {children}\r\n        </main>\r\n        <OwnerPowerBot />\r\n      </BookingNotificationsWrapper>\r\n    </AuthGuard>\r\n  );\r\n}\r\n\r\n// Wrapper component to initialize booking notifications hook\r\nfunction BookingNotificationsWrapper({ children }: { children: React.ReactNode }) {\r\n  useBookingNotificationsHook();\r\n  return <>{children}</>;\r\n}\r\n\r\n","// apps/dashboard/app/components/PublicLayoutWrapper.tsx\r\n// Wrapper that applies public layout to all public routes\r\n// This is used in the root layout to ensure all public routes get the header\r\n\r\n\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport LanguageToggle from \"./LanguageToggle\";\r\n\r\nexport default function PublicLayoutWrapper({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Global Public Header - appears on ALL public pages */}\r\n      <header className=\"bg-white border-b border-gray-200 sticky top-0 z-50\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex items-center justify-between h-16\">\r\n            <Link href=\"/\" className=\"text-3xl font-bold text-blue-600 hover:text-blue-700\">\r\n              Yoyaku Yo\r\n            </Link>\r\n            <nav className=\"flex items-center gap-4\">\r\n              <LanguageToggle />\r\n            </nav>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Main Content */}\r\n      <main>\r\n        {children}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\n","// apps/dashboard/app/components/OwnerPowerBot.tsx\r\n// Fixed bottom-right chat bubble for owner power bot\r\n\r\n\"use client\";\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { useAuth } from '@/lib/useAuth';\r\nimport { getSupabaseClient } from '@/lib/supabaseClient';\r\n\r\ninterface Message {\r\n  id: string;\r\n  content: string;\r\n  sender: 'owner' | 'bot';\r\n  timestamp: Date;\r\n}\r\n\r\nexport default function OwnerPowerBot() {\r\n  const { user } = useAuth();\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [ownerLanguage, setOwnerLanguage] = useState('en');\r\n  const [threadId, setThreadId] = useState<string | null>(null);\r\n  const [loadingThread, setLoadingThread] = useState(true);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const subscriptionRef = useRef<any>(null);\r\n  const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000';\r\n\r\n  // Load owner language\r\n  useEffect(() => {\r\n    if (user?.id) {\r\n      fetch(`${apiUrl}/users/me`, {\r\n        headers: { 'x-user-id': user.id },\r\n      })\r\n        .then(res => {\r\n          if (res.ok) {\r\n            return res.json();\r\n          }\r\n          return null;\r\n        })\r\n        .then(data => {\r\n          if (data) {\r\n            setOwnerLanguage(data.preferredLanguage || 'en');\r\n          }\r\n        })\r\n        .catch((error: any) => {\r\n          // Silently handle connection errors (API server not running)\r\n          if (!error?.message?.includes('Failed to fetch') && !error?.message?.includes('ERR_CONNECTION_REFUSED')) {\r\n            console.error('Error loading owner language:', error);\r\n          }\r\n        });\r\n    }\r\n  }, [user, apiUrl]);\r\n\r\n  // Get shop ID and owner thread\r\n  const [shopId, setShopId] = useState<string | null>(null);\r\n  useEffect(() => {\r\n    if (user?.id) {\r\n      fetch(`${apiUrl}/shops`, {\r\n        headers: { 'x-user-id': user.id },\r\n      })\r\n        .then(res => {\r\n          if (res.ok) {\r\n            return res.json();\r\n          }\r\n          return null;\r\n        })\r\n        .then(shops => {\r\n          if (shops && Array.isArray(shops) && shops.length > 0) {\r\n            const firstShopId = shops[0].id;\r\n            setShopId(firstShopId);\r\n            \r\n            // Get or create owner thread for this shop\r\n            fetch(`${apiUrl}/owner/thread?shopId=${firstShopId}`, {\r\n              headers: { 'x-user-id': user.id },\r\n            })\r\n              .then(res => {\r\n                if (res.ok) {\r\n                  return res.json();\r\n                }\r\n                return null;\r\n              })\r\n              .then(data => {\r\n                if (data?.threadId) {\r\n                  setThreadId(data.threadId);\r\n                  // Load thread messages\r\n                  loadThreadMessages(data.threadId);\r\n                }\r\n              })\r\n              .catch((error: any) => {\r\n                // Silently handle connection errors\r\n                if (!error?.message?.includes('Failed to fetch') && !error?.message?.includes('ERR_CONNECTION_REFUSED')) {\r\n                  console.error('Error loading owner thread:', error);\r\n                }\r\n              })\r\n              .finally(() => {\r\n                setLoadingThread(false);\r\n              });\r\n          } else {\r\n            setLoadingThread(false);\r\n          }\r\n        })\r\n        .catch((error: any) => {\r\n          // Silently handle connection errors (API server not running)\r\n          if (!error?.message?.includes('Failed to fetch') && !error?.message?.includes('ERR_CONNECTION_REFUSED')) {\r\n            console.error('Error loading shops:', error);\r\n          }\r\n          setLoadingThread(false);\r\n        });\r\n    } else {\r\n      setLoadingThread(false);\r\n    }\r\n  }, [user, apiUrl]);\r\n\r\n  // Load thread messages\r\n  const loadThreadMessages = async (threadIdToLoad: string) => {\r\n    try {\r\n      const res = await fetch(`${apiUrl}/messages/thread/${threadIdToLoad}`, {\r\n        headers: { 'x-user-id': user?.id || '' },\r\n      });\r\n      if (res.ok) {\r\n        const threadMessages = await res.json();\r\n        // Convert to local Message format\r\n        const convertedMessages: Message[] = (Array.isArray(threadMessages) ? threadMessages : []).map((msg: any) => ({\r\n          id: msg.id,\r\n          content: msg.content,\r\n          sender: msg.senderType === 'owner' ? 'owner' : 'bot',\r\n          timestamp: new Date(msg.createdAt),\r\n        }));\r\n        setMessages(convertedMessages);\r\n      }\r\n    } catch (error: any) {\r\n      // Silently handle connection errors\r\n      if (!error?.message?.includes('Failed to fetch') && !error?.message?.includes('ERR_CONNECTION_REFUSED')) {\r\n        console.error('Error loading thread messages:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Subscribe to real-time messages for owner thread\r\n  useEffect(() => {\r\n    if (threadId && isOpen) {\r\n      const supabase = getSupabaseClient();\r\n      \r\n      const channel = supabase\r\n        .channel(`owner_messages:thread_id=eq.${threadId}`)\r\n        .on(\r\n          'postgres_changes',\r\n          {\r\n            event: 'INSERT',\r\n            schema: 'public',\r\n            table: 'shop_messages',\r\n            filter: `thread_id=eq.${threadId}`,\r\n          },\r\n          (payload: any) => {\r\n            const newMessage = payload.new;\r\n            if (newMessage && newMessage.thread_id === threadId) {\r\n              // Check if message already exists\r\n              setMessages((prev) => {\r\n                const exists = prev.some((msg) => msg.id === newMessage.id);\r\n                if (exists) return prev;\r\n                \r\n                return [\r\n                  ...prev,\r\n                  {\r\n                    id: newMessage.id,\r\n                    content: newMessage.content,\r\n                    sender: newMessage.sender_type === 'owner' ? 'owner' : 'bot',\r\n                    timestamp: new Date(newMessage.created_at),\r\n                  },\r\n                ];\r\n              });\r\n            }\r\n          }\r\n        )\r\n        .subscribe();\r\n\r\n      subscriptionRef.current = channel;\r\n\r\n      return () => {\r\n        if (subscriptionRef.current) {\r\n          supabase.removeChannel(subscriptionRef.current);\r\n        }\r\n      };\r\n    }\r\n  }, [threadId, isOpen]);\r\n\r\n  // Load messages when chat opens\r\n  useEffect(() => {\r\n    if (isOpen && threadId && messages.length === 0) {\r\n      loadThreadMessages(threadId);\r\n    }\r\n  }, [isOpen, threadId]);\r\n\r\n  // Scroll to bottom\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  }, [messages, isOpen]);\r\n\r\n  // Send command or chat message\r\n  const handleSend = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!input.trim() || loading || !shopId) return;\r\n\r\n    const command = input.trim();\r\n    setInput('');\r\n    setLoading(true);\r\n\r\n    // Add owner message optimistically (will be replaced by real message from DB via real-time)\r\n    const tempOwnerMsgId = `temp_${Date.now()}`;\r\n    const ownerMsg: Message = {\r\n      id: tempOwnerMsgId,\r\n      content: command,\r\n      sender: 'owner',\r\n      timestamp: new Date(),\r\n    };\r\n    setMessages(prev => [...prev, ownerMsg]);\r\n\r\n    try {\r\n      // Build conversation history for context (last 10 messages)\r\n      const conversationHistory = messages\r\n        .slice(-10)\r\n        .map(msg => ({\r\n          role: msg.sender === 'owner' ? 'user' as const : 'assistant' as const,\r\n          content: msg.content,\r\n        }));\r\n\r\n      // Parse and execute command OR chat\r\n      const res = await fetch(`${apiUrl}/owner/command`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'x-user-id': user?.id || '',\r\n        },\r\n        body: JSON.stringify({\r\n          shopId,\r\n          command,\r\n          ownerLanguage,\r\n          conversationHistory, // Send conversation history for context\r\n          threadId: threadId, // Include thread ID to save messages\r\n        }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        \r\n        // Update threadId if returned (for new threads)\r\n        if (data.threadId && !threadId) {\r\n          setThreadId(data.threadId);\r\n        }\r\n        \r\n        // Add bot response optimistically (will be replaced by real message from DB via real-time)\r\n        const tempBotMsgId = `temp_${Date.now() + 1}`;\r\n        const botMsg: Message = {\r\n          id: tempBotMsgId,\r\n          content: data.message || 'Done!',\r\n          sender: 'bot',\r\n          timestamp: new Date(),\r\n        };\r\n        setMessages(prev => [...prev, botMsg]);\r\n        \r\n        // Real-time subscription will replace optimistic messages with real ones from DB\r\n        // Remove temp messages after a delay if they weren't replaced\r\n        setTimeout(() => {\r\n          setMessages(prev => prev.filter(msg => !msg.id.startsWith('temp_')));\r\n          // Reload to get all real messages\r\n          if (data.threadId || threadId) {\r\n            loadThreadMessages(data.threadId || threadId!);\r\n          }\r\n        }, 1000);\r\n      } else {\r\n        // Remove optimistic owner message on error\r\n        setMessages(prev => prev.filter(msg => msg.id !== tempOwnerMsgId));\r\n        \r\n        const errorData = await res.json().catch(() => ({}));\r\n        const errorMsg: Message = {\r\n          id: (Date.now() + 1).toString(),\r\n          content: `Error: ${errorData.error || errorData.message || 'Failed to execute command'}`,\r\n          sender: 'bot',\r\n          timestamp: new Date(),\r\n        };\r\n        setMessages(prev => [...prev, errorMsg]);\r\n      }\r\n    } catch (error: any) {\r\n      // Remove optimistic owner message on error\r\n      setMessages(prev => prev.filter(msg => msg.id !== tempOwnerMsgId));\r\n      \r\n      // Handle connection errors gracefully\r\n      if (error?.message?.includes('Failed to fetch') || error?.message?.includes('ERR_CONNECTION_REFUSED')) {\r\n        const errorMsg: Message = {\r\n          id: (Date.now() + 1).toString(),\r\n          content: 'Error: API server is not running. Please start the API server.',\r\n          sender: 'bot',\r\n          timestamp: new Date(),\r\n        };\r\n        setMessages(prev => [...prev, errorMsg]);\r\n      } else {\r\n        console.error('Error executing command/chat:', error);\r\n        const errorMsg: Message = {\r\n          id: (Date.now() + 1).toString(),\r\n          content: 'Error: Could not execute command or chat',\r\n          sender: 'bot',\r\n          timestamp: new Date(),\r\n        };\r\n        setMessages(prev => [...prev, errorMsg]);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Get bot title in owner's language\r\n  const botTitle = ownerLanguage === 'ja' ? 'AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà' : 'AI Assistant';\r\n\r\n  return (\r\n    <>\r\n      {/* Chat Bubble Button */}\r\n      {!isOpen && (\r\n        <button\r\n          onClick={() => setIsOpen(true)}\r\n          className=\"fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center z-50 group\"\r\n          aria-label=\"Open AI Assistant\"\r\n        >\r\n          <svg className=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\" />\r\n          </svg>\r\n          <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-pulse\"></span>\r\n        </button>\r\n      )}\r\n\r\n      {/* Chat Window */}\r\n      {isOpen && (\r\n        <div className=\"fixed bottom-6 right-6 w-96 h-[600px] bg-white rounded-xl shadow-2xl border border-gray-200 flex flex-col z-50\">\r\n          {/* Header */}\r\n          <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-3 rounded-t-xl flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"w-3 h-3 bg-green-400 rounded-full animate-pulse\"></div>\r\n              <h3 className=\"font-bold\">{botTitle}</h3>\r\n            </div>\r\n            <button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"text-white hover:text-gray-200 transition-colors\"\r\n            >\r\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Messages */}\r\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50\">\r\n            {messages.length === 0 && (\r\n              <div className=\"text-center text-gray-500 text-sm py-8\">\r\n                <p className=\"font-medium mb-2\">Chat with AI or give commands:</p>\r\n                <ul className=\"text-left space-y-1 text-xs\">\r\n                  <li>‚Ä¢ Commands: \"Cancel Mario X44's booking\"</li>\r\n                  <li>‚Ä¢ Commands: \"Close salon August 10-16\"</li>\r\n                  <li>‚Ä¢ Chat: \"How many bookings today?\"</li>\r\n                  <li>‚Ä¢ Chat: \"What's the weather?\"</li>\r\n                </ul>\r\n              </div>\r\n            )}\r\n            {messages.map((msg) => (\r\n              <div\r\n                key={msg.id}\r\n                className={`flex ${msg.sender === 'owner' ? 'justify-end' : 'justify-start'}`}\r\n              >\r\n                <div\r\n                  className={`max-w-[80%] rounded-lg px-3 py-2 ${\r\n                    msg.sender === 'owner'\r\n                      ? 'bg-blue-600 text-white'\r\n                      : 'bg-white text-gray-900 border border-gray-200'\r\n                  }`}\r\n                >\r\n                  <p className=\"text-sm\">{msg.content}</p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n            <div ref={messagesEndRef} />\r\n          </div>\r\n\r\n          {/* Input */}\r\n          <div className=\"border-t border-gray-200 p-3 bg-white rounded-b-xl\">\r\n            <form onSubmit={handleSend} className=\"flex gap-2\">\r\n              <input\r\n                type=\"text\"\r\n                value={input}\r\n                onChange={(e) => setInput(e.target.value)}\r\n                placeholder=\"Type a command or chat...\"\r\n                className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\r\n                disabled={loading}\r\n              />\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading || !input.trim()}\r\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\r\n              >\r\n                {loading ? '...' : '‚Üí'}\r\n              </button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\n","// apps/dashboard/lib/useBookingNotifications.ts\r\n// Hook for subscribing to booking notifications via Supabase Realtime\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useRef, useCallback } from 'react';\r\nimport { useAuth } from './useAuth';\r\nimport { getSupabaseClient } from './supabaseClient';\r\nimport { useBookingNotifications } from '../app/components/BookingNotificationContext';\r\n\r\nconst apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000';\r\n\r\nexport function useBookingNotificationsHook() {\r\n  const { user } = useAuth();\r\n  const { setUnreadBookingsCount } = useBookingNotifications();\r\n  const subscriptionRef = useRef<any>(null);\r\n  const shopIdsRef = useRef<string[]>([]);\r\n\r\n  const reloadPendingCount = useCallback(async () => {\r\n    if (!user?.id) return;\r\n\r\n    try {\r\n      const bookingsRes = await fetch(`${apiUrl}/bookings`, {\r\n        headers: {\r\n          'x-user-id': user.id,\r\n        },\r\n      });\r\n\r\n      if (bookingsRes.ok) {\r\n        const bookingsData = await bookingsRes.json();\r\n        const bookings = Array.isArray(bookingsData) ? bookingsData : [];\r\n        const pendingCount = bookings.filter((booking: any) => booking.status === 'pending').length;\r\n        setUnreadBookingsCount(pendingCount);\r\n      }\r\n      } catch (error: any) {\r\n        // Silently handle connection errors (API server not running)\r\n        if (!error?.message?.includes('Failed to fetch') && !error?.message?.includes('ERR_CONNECTION_REFUSED')) {\r\n          console.error('Error reloading pending bookings count:', error);\r\n        }\r\n        setUnreadBookingsCount(0);\r\n      }\r\n  }, [user?.id, setUnreadBookingsCount]);\r\n\r\n  const subscribeToBookingUpdates = useCallback(() => {\r\n    if (!user?.id) return;\r\n\r\n    const supabase = getSupabaseClient();\r\n\r\n    // Subscribe to bookings table for INSERT and UPDATE events\r\n    const channel = supabase\r\n      .channel('booking_notifications')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'bookings',\r\n        },\r\n        async (payload: any) => {\r\n          const newBooking = payload.new;\r\n          \r\n          // Check if booking belongs to owner's shop and is pending\r\n          if (newBooking && newBooking.status === 'pending') {\r\n            // If we have shop IDs cached, check immediately\r\n            if (shopIdsRef.current.length > 0 && shopIdsRef.current.includes(newBooking.shop_id)) {\r\n              // Reload count to ensure accuracy\r\n              await reloadPendingCount();\r\n            } else {\r\n              // Otherwise, reload count to be safe\r\n              await reloadPendingCount();\r\n            }\r\n          }\r\n        }\r\n      )\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'UPDATE',\r\n          schema: 'public',\r\n          table: 'bookings',\r\n        },\r\n        async (payload: any) => {\r\n          const updatedBooking = payload.new;\r\n          const oldBooking = payload.old;\r\n\r\n          // If status changed from pending to something else, decrement\r\n          if (oldBooking?.status === 'pending' && updatedBooking?.status !== 'pending') {\r\n            // Reload count to ensure accuracy\r\n            await reloadPendingCount();\r\n          }\r\n          // If status changed to pending, reload count\r\n          else if (oldBooking?.status !== 'pending' && updatedBooking?.status === 'pending') {\r\n            await reloadPendingCount();\r\n          }\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    subscriptionRef.current = channel;\r\n  }, [user?.id, reloadPendingCount, setUnreadBookingsCount]);\r\n\r\n  // Load initial pending bookings count and get shop IDs\r\n  useEffect(() => {\r\n    if (!user?.id) {\r\n      setUnreadBookingsCount(0);\r\n      return;\r\n    }\r\n\r\n    const loadPendingBookingsCount = async () => {\r\n      try {\r\n        // First, get shop IDs for this owner\r\n        const shopsRes = await fetch(`${apiUrl}/shops`, {\r\n          headers: {\r\n            'x-user-id': user.id,\r\n          },\r\n        });\r\n\r\n        if (shopsRes.ok) {\r\n          const shopsData = await shopsRes.json();\r\n          const shops = Array.isArray(shopsData) ? shopsData : [];\r\n          shopIdsRef.current = shops.map((shop: any) => shop.id);\r\n\r\n          if (shopIdsRef.current.length === 0) {\r\n            setUnreadBookingsCount(0);\r\n            return;\r\n          }\r\n\r\n          // Get pending bookings count\r\n          const bookingsRes = await fetch(`${apiUrl}/bookings`, {\r\n            headers: {\r\n              'x-user-id': user.id,\r\n            },\r\n          });\r\n\r\n          if (bookingsRes.ok) {\r\n            const bookingsData = await bookingsRes.json();\r\n            const bookings = Array.isArray(bookingsData) ? bookingsData : [];\r\n            const pendingCount = bookings.filter((booking: any) => booking.status === 'pending').length;\r\n            setUnreadBookingsCount(pendingCount);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        // Silently handle connection errors (API server not running)\r\n        if (!error?.message?.includes('Failed to fetch') && !error?.message?.includes('ERR_CONNECTION_REFUSED')) {\r\n          console.error('Error loading pending bookings count:', error);\r\n        }\r\n        setUnreadBookingsCount(0);\r\n      }\r\n    };\r\n\r\n    loadPendingBookingsCount();\r\n    subscribeToBookingUpdates();\r\n\r\n    return () => {\r\n      if (subscriptionRef.current) {\r\n        const supabase = getSupabaseClient();\r\n        supabase.removeChannel(subscriptionRef.current);\r\n      }\r\n    };\r\n  }, [user, setUnreadBookingsCount, subscribeToBookingUpdates]);\r\n}\r\n\r\n","\"use client\";\nimport{IntlProvider as r}from\"use-intl/react\";import{jsx as o}from\"react/jsx-runtime\";function t({locale:t,...e}){if(!t)throw new Error(void 0);return o(r,{locale:t,...e})}export{t as default};\n","'use client';\r\n\r\nimport { NextIntlClientProvider } from 'next-intl';\r\nimport { ReactNode, useEffect, useState } from 'react';\r\n// Import default messages for SSR\r\nimport enMessages from '../../messages/en.json';\r\nimport jaMessages from '../../messages/ja.json';\r\n\r\n// Ensure messages are always valid objects\r\nconst defaultMessages = enMessages && typeof enMessages === 'object' ? enMessages : {};\r\nconst defaultJaMessages = jaMessages && typeof jaMessages === 'object' ? jaMessages : {};\r\n\r\nexport function NextIntlProviderWrapper({ children }: { children: ReactNode }) {\r\n  const [locale, setLocale] = useState<'en' | 'ja'>('en');\r\n  const [messages, setMessages] = useState<any>(defaultMessages); // Start with default messages\r\n\r\n  useEffect(() => {\r\n    // Get locale from cookie or localStorage\r\n    const getStoredLocale = (): 'en' | 'ja' => {\r\n      if (typeof window === 'undefined') return 'en';\r\n      \r\n      // Try cookie first\r\n      const cookies = document.cookie.split(';');\r\n      const langCookie = cookies.find(c => c.trim().startsWith('yoyaku_yo_language='));\r\n      if (langCookie) {\r\n        const value = langCookie.split('=')[1]?.trim();\r\n        if (value === 'en' || value === 'ja') {\r\n          return value;\r\n        }\r\n      }\r\n      \r\n      // Fallback to localStorage\r\n      const stored = localStorage.getItem('yoyaku_yo_language');\r\n      if (stored === 'en' || stored === 'ja') {\r\n        return stored;\r\n      }\r\n      \r\n      return 'en';\r\n    };\r\n\r\n    const currentLocale = getStoredLocale();\r\n    setLocale(currentLocale);\r\n    \r\n    // Set messages based on locale\r\n    if (currentLocale === 'ja') {\r\n      setMessages(defaultJaMessages);\r\n    } else {\r\n      setMessages(defaultMessages);\r\n    }\r\n  }, []);\r\n\r\n  // Listen for locale changes\r\n  useEffect(() => {\r\n    const handleStorageChange = () => {\r\n      // Check both cookie and localStorage\r\n      const cookies = document.cookie.split(';');\r\n      const langCookie = cookies.find(c => c.trim().startsWith('yoyaku_yo_language='));\r\n      let newLocale: 'en' | 'ja' | null = null;\r\n      \r\n      if (langCookie) {\r\n        const value = langCookie.split('=')[1]?.trim();\r\n        if (value === 'en' || value === 'ja') {\r\n          newLocale = value;\r\n        }\r\n      }\r\n      \r\n      // Fallback to localStorage if cookie not found\r\n      if (!newLocale) {\r\n        const stored = localStorage.getItem('yoyaku_yo_language');\r\n        if (stored === 'en' || stored === 'ja') {\r\n          newLocale = stored;\r\n        }\r\n      }\r\n      \r\n      if (newLocale) {\r\n        // Use functional update to avoid dependency on locale\r\n        setLocale(prevLocale => {\r\n          if (prevLocale !== newLocale) {\r\n            setMessages(newLocale === 'ja' ? defaultJaMessages : defaultMessages);\r\n            return newLocale;\r\n          }\r\n          return prevLocale;\r\n        });\r\n      }\r\n    };\r\n\r\n    // Listen for custom event when language changes\r\n    window.addEventListener('languageChanged', handleStorageChange);\r\n    window.addEventListener('storage', handleStorageChange);\r\n\r\n    return () => {\r\n      window.removeEventListener('languageChanged', handleStorageChange);\r\n      window.removeEventListener('storage', handleStorageChange);\r\n    };\r\n  }, []); // Empty dependency array - only set up listeners once\r\n\r\n  // Ensure messages is always a valid object with proper structure\r\n  const safeMessages = messages && typeof messages === 'object' ? messages : defaultMessages;\r\n  \r\n  // Validate that shops.photos exists in messages\r\n  if (process.env.NODE_ENV === 'development' && safeMessages.shops && !safeMessages.shops.photos) {\r\n    console.warn('‚ö†Ô∏è shops.photos missing in messages, adding fallback');\r\n    safeMessages.shops = {\r\n      ...safeMessages.shops,\r\n      photos: locale === 'ja' ? 'ÂÜôÁúü' : 'Photos',\r\n    };\r\n  }\r\n  \r\n  return (\r\n    <NextIntlClientProvider \r\n      locale={locale} \r\n      messages={safeMessages}\r\n      onError={(error) => {\r\n        // Silently handle missing translation keys - getMessageFallback will handle them\r\n        // Only log unexpected errors in development\r\n        if (process.env.NODE_ENV === 'development' && error.code !== 'MISSING_MESSAGE') {\r\n          console.warn('next-intl error:', error);\r\n        }\r\n      }}\r\n      getMessageFallback={({ namespace, key, error }) => {\r\n        // Provide fallback for missing messages\r\n        if (key === 'shops.photos') {\r\n          return locale === 'ja' ? 'ÂÜôÁúü' : 'Photos';\r\n        }\r\n        \r\n        // Handle missing city/prefecture keys gracefully\r\n        if (key.startsWith('cities.') || key.startsWith('prefectures.')) {\r\n          // Extract the name from the key (e.g., \"cities.tokyo\" -> \"tokyo\")\r\n          const name = key.split('.').pop() || key;\r\n          // Format nicely: replace dashes/underscores with spaces, capitalize words\r\n          return name\r\n            .replace(/[-_]/g, ' ')\r\n            .replace(/\\b\\w/g, (l) => l.toUpperCase())\r\n            .trim();\r\n        }\r\n        \r\n        // For other missing keys, return the key itself (next-intl will handle it)\r\n        return key;\r\n      }}\r\n    >\r\n      {children}\r\n    </NextIntlClientProvider>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","ignoreList":[4]}