module.exports=[52302,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(67254),e=a.i(50944),f=a.i(15925);function g({title:a,value:c,change:d,changeLabel:e,icon:f,subtitle:g}){let h=void 0!==d?d>=0?"text-green-600":"text-red-600":"text-gray-600";return(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:a}),f&&(0,b.jsx)("div",{className:"text-gray-400",children:f})]}),(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:c}),void 0!==d&&(0,b.jsxs)("span",{className:`text-sm font-medium ${h}`,children:[d>=0?"+":"",d,"%"]})]}),e&&(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e}),g&&(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:g})]})}function h({data:a,xLabel:c,yLabel:d,height:e=200,color:f="#3B82F6"}){if(!a||0===a.length)return(0,b.jsx)("div",{className:"flex items-center justify-center text-gray-500",style:{height:e},children:"No data available"});let g=e-80,h=Math.max(...a.map(a=>a.y),1),i=Math.min(...a.map(a=>a.y),0),j=b=>b/(a.length-1||1)*520+40,k=a=>g-(a-i)/(h-i||1)*(g-40)+40,l=a.map((a,b)=>`${j(b)},${k(a.y)}`).join(" ");return(0,b.jsx)("div",{className:"w-full",children:(0,b.jsxs)("svg",{viewBox:`0 0 600 ${e}`,className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[[0,.25,.5,.75,1].map(a=>{let c=40+a*(g-40);return(0,b.jsx)("line",{x1:40,y1:c,x2:560,y2:c,stroke:"#E5E7EB",strokeWidth:"1"},a)}),(0,b.jsx)("polyline",{points:l,fill:"none",stroke:f,strokeWidth:"2"}),a.map((a,c)=>(0,b.jsx)("circle",{cx:j(c),cy:k(a.y),r:"4",fill:f},c)),c&&(0,b.jsx)("text",{x:300,y:e-10,textAnchor:"middle",className:"text-xs fill-gray-600",children:c}),d&&(0,b.jsx)("text",{x:15,y:e/2,textAnchor:"middle",className:"text-xs fill-gray-600",transform:`rotate(-90, 15, ${e/2})`,children:d})]})})}function i({data:a,height:c=200,showValues:d=!0}){if(!a||0===a.length)return(0,b.jsx)("div",{className:"flex items-center justify-center text-gray-500",style:{height:c},children:"No data available"});let e=Math.max(20,520/a.length-10),f=Math.max(...a.map(a=>a.value),1);return(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)("svg",{viewBox:`0 0 600 ${c}`,className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:a.map((a,g)=>{let h=a.value/f*(c-80),i=40+g*(e+10),j=c-40-h,k=a.color||"#3B82F6";return(0,b.jsxs)("g",{children:[(0,b.jsx)("rect",{x:i,y:j,width:e,height:h,fill:k,rx:"4"}),d&&a.value>0&&(0,b.jsx)("text",{x:i+e/2,y:j-5,textAnchor:"middle",className:"text-xs fill-gray-700 font-medium",children:a.value}),(0,b.jsx)("text",{x:i+e/2,y:c-10,textAnchor:"middle",className:"text-xs fill-gray-600",transform:`rotate(-45, ${i+e/2}, ${c-10})`,children:a.label})]},g)})})})}function j(){let{user:a,loading:j}=(0,d.useAuth)(),k=(0,e.useRouter)(),l=(0,f.useTranslations)(),m="http://localhost:3000",[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)("30"),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)([]);(0,c.useEffect)(()=>{j||a?a&&J():k.push("/")},[a,j,k]),(0,c.useEffect)(()=>{n&&K()},[n,r,t,v]);let J=async()=>{try{let b=await fetch(`${m}/shops?owner_user_id=${a?.id}`,{headers:{"x-user-id":a?.id||""}});if(b.ok){let a=await b.json();a&&a.length>0&&o(a[0])}}catch(a){console.error("Error loading shop:",a)}finally{q(!1)}},K=async()=>{let b;if(!n)return;let{startDate:c,endDate:d}=(b=new Date().toISOString(),"custom"===r&&t&&v?{startDate:t,endDate:v}:{startDate:new Date("7"===r?Date.now()-6048e5:"90"===r?Date.now()-7776e6:Date.now()-2592e6).toISOString(),endDate:b});try{q(!0);let[b,e,f,g,h,i]=await Promise.all([fetch(`${m}/analytics/shop/${n.id}/overview?start_date=${c}&end_date=${d}`,{headers:{"x-user-id":a?.id||""}}),fetch(`${m}/analytics/shop/${n.id}/bookings?start_date=${c}&end_date=${d}&group_by=day`,{headers:{"x-user-id":a?.id||""}}),fetch(`${m}/analytics/shop/${n.id}/services?start_date=${c}&end_date=${d}`,{headers:{"x-user-id":a?.id||""}}),fetch(`${m}/analytics/shop/${n.id}/staff?start_date=${c}&end_date=${d}`,{headers:{"x-user-id":a?.id||""}}),fetch(`${m}/analytics/shop/${n.id}/customers?start_date=${c}&end_date=${d}`,{headers:{"x-user-id":a?.id||""}}),fetch(`${m}/analytics/shop/${n.id}/peak-hours?start_date=${c}&end_date=${d}`,{headers:{"x-user-id":a?.id||""}})]);if(b.ok){let a=await b.json();y(a)}if(e.ok){let a=await e.json();A(a)}if(f.ok){let a=await f.json();C(a)}if(g.ok){let a=await g.json();E(a)}if(h.ok){let a=await h.json();G(a)}if(i.ok){let a=await i.json();I(a)}}catch(a){console.error("Error loading analytics:",a)}finally{q(!1)}};return p&&!n?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("p",{className:"text-gray-500",children:l("common.loading")})}):n?(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:l("analytics.title")}),(0,b.jsx)("p",{className:"text-gray-600",children:n.name})]}),(0,b.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,b.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:[l("analytics.dateRange"),":"]}),(0,b.jsx)("button",{onClick:()=>s("7"),className:`px-4 py-2 rounded-md ${"7"===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:l("analytics.last7Days")}),(0,b.jsx)("button",{onClick:()=>s("30"),className:`px-4 py-2 rounded-md ${"30"===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:l("analytics.last30Days")}),(0,b.jsx)("button",{onClick:()=>s("90"),className:`px-4 py-2 rounded-md ${"90"===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:l("analytics.last90Days")}),(0,b.jsx)("button",{onClick:()=>s("custom"),className:`px-4 py-2 rounded-md ${"custom"===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:l("analytics.custom")}),"custom"===r&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"date",value:t,onChange:a=>u(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-md"}),(0,b.jsx)("span",{children:"to"}),(0,b.jsx)("input",{type:"date",value:v,onChange:a=>w(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-md"})]})]})}),x&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,b.jsx)(g,{title:l("analytics.bookings"),value:x.totalBookings,subtitle:l("analytics.averagePerDay")+": "+x.averageBookingsPerDay.toFixed(1)}),(0,b.jsx)(g,{title:l("analytics.revenue"),value:`\xa5${x.totalRevenue.toLocaleString()}`,subtitle:l("analytics.averagePerDay")+": Â¥"+x.averageRevenuePerDay.toFixed(0)}),(0,b.jsx)(g,{title:l("analytics.cancellationRate"),value:`${x.cancellationRate.toFixed(1)}%`}),(0,b.jsx)(g,{title:l("analytics.completedBookings"),value:x.completedBookings})]}),z.length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:l("analytics.bookingTrends")}),(0,b.jsx)(h,{data:z.map(a=>({x:a.date,y:a.count})),height:300,xLabel:l("analytics.date"),yLabel:l("analytics.bookings")})]}),B.length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:l("analytics.servicePopularity")}),(0,b.jsx)(i,{data:B.slice(0,10).map(a=>({label:a.serviceName,value:a.bookingCount})),height:300})]}),D.length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:l("analytics.staffPerformance")}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:l("myShop.staff")}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:l("analytics.bookings")})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.staffName}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.bookingCount})]},a.staffId))})]})})]}),F&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:l("analytics.customerAnalytics")}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsx)(g,{title:l("analytics.newCustomers"),value:F.newCustomers}),(0,b.jsx)(g,{title:l("analytics.returningCustomers"),value:F.returningCustomers})]})]}),H.length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:l("analytics.peakHours")}),(0,b.jsx)(i,{data:H.map(a=>({label:`${a.hour}:00`,value:a.bookingCount})),height:300})]})]}):(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,b.jsx)("p",{className:"text-gray-500",children:l("myShop.noShop")})})}a.s(["default",()=>j],52302)}];

//# sourceMappingURL=apps_dashboard_app_%28owner%29_analytics_page_tsx_4ecceba4._.js.map