module.exports=[4837,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(3214);function f(){let a=(0,d.useParams)();(0,d.useRouter)();let f=a.magicCode,[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!0),q=(0,c.useRef)(null),r="http://localhost:3000",s=(0,e.getSupabaseClient)();(0,c.useEffect)(()=>{f&&(async()=>{try{let a=await fetch(`${r}/customers/magic/${f}`);if(a.ok){let b=await a.json();h(b),b.threadId&&t(b.threadId)}else console.error("Customer not found")}catch(a){console.error("Error initializing customer:",a)}finally{p(!1)}})()},[f,r]);let t=async a=>{try{let b=await fetch(`${r}/messages/thread/${a}`);if(b.ok){let a=await b.json(),c=Array.isArray(a)?a:[];j(c)}}catch(a){console.error("Error loading messages:",a)}};(0,c.useEffect)(()=>{if(!g?.threadId)return;let a=s.channel(`thread-${g.threadId}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"shop_messages",filter:`thread_id=eq.${g.threadId}`},a=>{let b=a.new;j(a=>[...a,b])}).subscribe();return()=>{s.removeChannel(a)}},[g?.threadId,s]),(0,c.useEffect)(()=>{q.current?.scrollIntoView({behavior:"smooth"})},[i]);let u=(0,c.useRef)(null),v=async a=>{if(a.preventDefault(),!k.trim()||m||!g)return;let b=k.trim();l(""),n(!0);try{(await fetch(`${r}/messages/thread/${g.threadId}/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderType:"customer",content:b})})).ok&&await fetch(`${r}/ai/chat-thread`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:g.threadId,shopId:g.shopId,message:b,source:"customer"})})}catch(a){console.error("Error sending message:",a)}finally{n(!1),setTimeout(()=>{u.current?.focus()},100)}};return o?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading your chat..."})]})}):g?(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex flex-col",children:[(0,b.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:[g.customer_id_display,"さん"]}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Your permanent chat"})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-6",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[i.map(a=>(0,b.jsx)("div",{className:`flex ${"customer"===a.sender_type?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[80%] rounded-lg px-4 py-2 ${"customer"===a.sender_type?"bg-blue-600 text-white":"owner"===a.sender_type?"bg-purple-600 text-white":"bg-white text-gray-900 border border-gray-200"}`,children:[(0,b.jsx)("p",{className:"text-sm",children:a.translatedContent||a.content}),a.originalContent&&a.originalContent!==a.translatedContent&&(0,b.jsxs)("p",{className:"text-xs mt-1 opacity-75 italic",children:[a.originalContent.substring(0,50),"..."]})]})},a.id)),(0,b.jsx)("div",{ref:q})]})}),(0,b.jsx)("div",{className:"bg-white border-t border-gray-200 px-4 py-4",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,b.jsxs)("form",{onSubmit:v,className:"flex gap-2",children:[(0,b.jsx)("input",{ref:u,type:"text",value:k,onChange:a=>l(a.target.value),placeholder:"Type your message...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:m,autoFocus:!0}),(0,b.jsx)("button",{type:"submit",disabled:m||!k.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Sending...":"Send"})]})})})]}):(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Chat Not Found"}),(0,b.jsx)("p",{className:"text-gray-600",children:"This chat link is invalid or has expired."})]})})}a.s(["default",()=>f])}];

//# sourceMappingURL=apps_dashboard_app_c_%5BmagicCode%5D_page_tsx_28dcb460._.js.map