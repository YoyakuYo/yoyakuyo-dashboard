{"version":3,"sources":["../../../../../../apps/dashboard/app/timeslots/page.tsx"],"sourcesContent":["// apps/dashboard/app/timeslots/page.tsx\r\n\r\n\"use client\";\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { useAuth } from '@/lib/useAuth';\r\n\r\ninterface Timeslot {\r\n  id: string;\r\n  staff_id: string;\r\n  day_of_week: number;\r\n  start_time: string;\r\n  end_time: string;\r\n}\r\n\r\ninterface Staff {\r\n  id: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  shop_id: string;\r\n}\r\n\r\ninterface Shop {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\nconst TimeslotsPage = () => {\r\n  const { user } = useAuth();\r\n  const [timeslots, setTimeslots] = useState<Timeslot[]>([]);\r\n  const [staff, setStaff] = useState<Staff[]>([]);\r\n  const [shops, setShops] = useState<Shop[]>([]);\r\n  const [selectedStaff, setSelectedStaff] = useState<string>('');\r\n  const [selectedDate, setSelectedDate] = useState<string>(new Date().toISOString().split('T')[0]);\r\n  const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000';\r\n\r\n  const daysOfWeek = [\r\n    'Sunday',\r\n    'Monday',\r\n    'Tuesday',\r\n    'Wednesday',\r\n    'Thursday',\r\n    'Friday',\r\n    'Saturday',\r\n  ];\r\n\r\n  useEffect(() => {\r\n    if (!user) return;\r\n\r\n    const fetchData = async () => {\r\n      try {\r\n        const headers: HeadersInit = {\r\n          'x-user-id': user.id,\r\n        };\r\n\r\n        // Fetch timeslots (filtered by user's shops)\r\n        const timeslotsRes = await fetch(`${apiUrl}/timeslots`, { headers });\r\n        if (timeslotsRes.ok) {\r\n          const timeslotsData = await timeslotsRes.json();\r\n          setTimeslots(Array.isArray(timeslotsData) ? timeslotsData : []);\r\n        }\r\n\r\n        // Fetch staff (filtered by user's shops)\r\n        const staffRes = await fetch(`${apiUrl}/staff`, { headers });\r\n        if (staffRes.ok) {\r\n          const staffData = await staffRes.json();\r\n          setStaff(Array.isArray(staffData) ? staffData : []);\r\n        }\r\n\r\n        // Fetch all shops\r\n        const shopsRes = await fetch(`${apiUrl}/shops`);\r\n        if (shopsRes.ok) {\r\n          const shopsData = await shopsRes.json();\r\n          setShops(Array.isArray(shopsData) ? shopsData : []);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching data:\", error);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [apiUrl, user]);\r\n\r\n  const getStaffName = (staffId: string) => {\r\n    const staffMember = staff.find(s => s.id === staffId);\r\n    return staffMember ? `${staffMember.first_name} ${staffMember.last_name}` : 'Unknown Staff';\r\n  };\r\n\r\n  const getShopName = (shopId: string) => {\r\n    const shop = shops.find(s => s.id === shopId);\r\n    return shop ? shop.name : 'Unknown Shop';\r\n  };\r\n\r\n  const getStaffShopId = (staffId: string) => {\r\n    const staffMember = staff.find(s => s.id === staffId);\r\n    return staffMember?.shop_id || '';\r\n  };\r\n\r\n  const filteredTimeslots = timeslots.filter(timeslot => {\r\n    if (selectedStaff && timeslot.staff_id !== selectedStaff) {\r\n      return false;\r\n    }\r\n    if (selectedDate) {\r\n      const selectedDay = new Date(selectedDate).getDay();\r\n      return timeslot.day_of_week === selectedDay;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  const groupedByStaff = filteredTimeslots.reduce((acc, timeslot) => {\r\n    const staffId = timeslot.staff_id;\r\n    if (!acc[staffId]) {\r\n      acc[staffId] = [];\r\n    }\r\n    acc[staffId].push(timeslot);\r\n    return acc;\r\n  }, {} as Record<string, Timeslot[]>);\r\n\r\n  // Show empty state if user has no shops\r\n  if (user && shops.length === 0) {\r\n    return (\r\n      <div className=\"p-8\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Timeslots</h1>\r\n          <p className=\"text-gray-600\">View staff availability and generated timeslots</p>\r\n        </div>\r\n        <div className=\"bg-white rounded-xl shadow-md border border-gray-100 p-12 text-center\">\r\n          <div className=\"text-6xl mb-4\">üè™</div>\r\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">No Shops Found</h2>\r\n          <p className=\"text-gray-600 mb-6\">\r\n            You need to create or claim a shop before you can view timeslots.\r\n          </p>\r\n          <Link\r\n            href=\"/shops\"\r\n            className=\"inline-block bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-200\"\r\n          >\r\n            Go to Shops ‚Üí\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-8\">\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Timeslots</h1>\r\n        <p className=\"text-gray-600\">View staff availability and generated timeslots</p>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\r\n        {/* Filters */}\r\n        <div className=\"lg:col-span-1\">\r\n          <div className=\"bg-white rounded-xl shadow-md p-6 border border-gray-100\">\r\n            <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Filters</h2>\r\n            <div className=\"flex flex-col gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Staff</label>\r\n                <select\r\n                  value={selectedStaff}\r\n                  onChange={(e) => setSelectedStaff(e.target.value)}\r\n                  className=\"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition\"\r\n                >\r\n                  <option value=\"\">All Staff</option>\r\n                  {staff.map(member => (\r\n                    <option key={member.id} value={member.id}>\r\n                      {member.first_name} {member.last_name} - {getShopName(member.shop_id)}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Date</label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={selectedDate}\r\n                  onChange={(e) => setSelectedDate(e.target.value)}\r\n                  className=\"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Schedule */}\r\n        <div className=\"lg:col-span-3\">\r\n          <div className=\"bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden\">\r\n            <div className=\"px-6 py-4 border-b border-gray-200 bg-gray-50\">\r\n              <h2 className=\"text-xl font-bold text-gray-800\">Schedule</h2>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              {Object.keys(groupedByStaff).length > 0 ? (\r\n                <div className=\"space-y-6\">\r\n                  {Object.entries(groupedByStaff).map(([staffId, slots]) => (\r\n                    <div key={staffId} className=\"border-b border-gray-200 pb-6 last:border-b-0 last:pb-0\">\r\n                      <div className=\"flex items-center gap-3 mb-4\">\r\n                        <div className=\"w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-bold\">\r\n                          {getStaffName(staffId).charAt(0)}\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"text-lg font-bold text-gray-800\">\r\n                            {getStaffName(staffId)}\r\n                          </h3>\r\n                          <p className=\"text-sm text-gray-500\">{getShopName(getStaffShopId(staffId))}</p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\r\n                        {slots.map(slot => (\r\n                          <div\r\n                            key={slot.id}\r\n                            className=\"bg-green-50 border border-green-200 rounded-lg p-4\"\r\n                          >\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                              <span className=\"text-xs font-semibold text-green-700 uppercase tracking-wide\">\r\n                                {daysOfWeek[slot.day_of_week]}\r\n                              </span>\r\n                              <span className=\"px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full\">\r\n                                Available\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"text-sm text-gray-700\">\r\n                              <span className=\"font-medium\">{slot.start_time}</span>\r\n                              <span className=\"mx-2\">-</span>\r\n                              <span className=\"font-medium\">{slot.end_time}</span>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-center py-12\">\r\n                  <div className=\"text-6xl mb-4\">üìÖ</div>\r\n                  <p className=\"text-gray-500 text-lg mb-2\">No timeslots found</p>\r\n                  <p className=\"text-gray-400 text-sm\">\r\n                    {selectedStaff || selectedDate\r\n                      ? 'Try adjusting your filters'\r\n                      : 'Create availability for staff members to generate timeslots'}\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TimeslotsPage;\r\n\r\n"],"names":[],"mappings":"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"}