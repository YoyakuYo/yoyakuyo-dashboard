module.exports=[56721,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(15925),f=a.i(3214);function g(){let a=(0,d.useParams)(),g=a?.shopId,h=(0,e.useTranslations)(),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),y="http://localhost:3000",[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),J=(0,c.useRef)(null),K=(0,c.useRef)(null),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(null);(0,c.useEffect)(()=>{J.current?.scrollIntoView({behavior:"smooth"})},[B]),(0,c.useEffect)(()=>{},[]),(0,c.useEffect)(()=>{g&&(async()=>{try{let a=await fetch(`${y}/qr/shop/${g}/line`);if(a.ok){let b=await a.json();O(b.qrImageUrl),Q(b.deeplinkUrl)}}catch(a){}})()},[g,y]),(0,c.useEffect)(()=>(g&&!z&&L&&(async()=>{try{let a=await fetch(`${y}/messages/start-thread`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:g,bookingId:null,threadType:"customer",anonymousSessionId:L})});if(a.ok){let b=await a.json();A(b.threadId),R(b.threadId),S(b.threadId)}}catch(a){a?.message?.includes("Failed to fetch")||a?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error starting thread:",a)}})(),()=>{K.current&&(0,f.getSupabaseClient)().removeChannel(K.current)}),[g,z,y]);let R=async a=>{try{let b=L?`${y}/messages/thread/${a}?anonymousSessionId=${encodeURIComponent(L)}`:`${y}/messages/thread/${a}`,c=await fetch(b);if(c.ok){let a=await c.json();C(Array.isArray(a)?a:[])}}catch(a){a?.message?.includes("Failed to fetch")||a?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error loading messages:",a)}},S=a=>{K.current=(0,f.getSupabaseClient)().channel(`shop_messages:thread_id=eq.${a}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"shop_messages",filter:`thread_id=eq.${a}`},b=>{let c=b.new;c&&c.thread_id===a&&C(a=>a.some(a=>a.id===c.id)?a:[...a,{id:c.id,senderType:c.sender_type,content:c.content,createdAt:c.created_at,readByOwner:c.read_by_owner||!1,readByCustomer:c.read_by_customer||!1}])}).subscribe()},T=async()=>{if(!z||!D.trim()||F)return;let a=D.trim();E("");let b=`temp-${Date.now()}`,c={id:b,senderType:"customer",content:a,createdAt:new Date().toISOString(),readByOwner:!1,readByCustomer:!0};C(a=>[...a,c]),G(!0);try{let c=await fetch(`${y}/messages/thread/${z}/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderType:"customer",content:a})});if(c.ok){let a=await c.json();C(c=>c.map(c=>c.id===b?{id:a.id,senderType:a.senderType,content:a.content,createdAt:a.createdAt,readByOwner:a.readByOwner,readByCustomer:a.readByCustomer}:c))}else C(a=>a.filter(a=>a.id!==b)),alert("Failed to send message. Please try again.")}catch(a){a?.message?.includes("Failed to fetch")||a?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error sending message:",a),C(a=>a.filter(a=>a.id!==b)),a?.message?.includes("Failed to fetch")||a?.message?.includes("ERR_CONNECTION_REFUSED")||alert("Failed to send message. Please try again.")}finally{G(!1)}};(0,c.useEffect)(()=>{let a=async()=>{try{let a=await fetch(`${y}/shops/${g}/staff`);if(a.ok){let b=await a.json();l(Array.isArray(b)?b:[])}else console.error("Failed to fetch staff:",a.status,a.statusText),l([])}catch(a){a?.message?.includes("Failed to fetch")||a?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error fetching staff:",a),l([])}};(async()=>{try{let a=await fetch(`${y}/shops/${g}/services`);if(a.ok){let b=await a.json();j(Array.isArray(b)?b:[])}else console.error("Failed to fetch services:",a.status,a.statusText),j([])}catch(a){a?.message?.includes("Failed to fetch")||a?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error fetching services:",a),j([])}})(),a()},[g,y]);let U=async()=>{if(s&&q)try{let a=await fetch(`${y}/shops/${g}/availability?date=${s}`);if(a.ok){let b=await a.json();n(Array.isArray(b)?b:[])}else console.error("Failed to fetch availability:",a.status,a.statusText),n([])}catch(a){a?.message?.includes("Failed to fetch")||a?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error fetching availability:",a),n([])}},V=async()=>{if(o&&q&&s&&u){let a=u.trim().split(/\s+/),b=a[0]||u,c=a.slice(1).join(" ")||null;try{let a=await fetch(`${y}/bookings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop_id:g,service_id:o,staff_id:q,start_time:s,end_time:s,first_name:b,last_name:c,notes:`Booking for ${u}`})});if(a.ok)await a.json(),alert(h("booking.bookingSuccessful"));else{let b=await a.json().catch(()=>({error:h("common.unknown")}));alert(`${h("booking.bookingFailed")}: ${b.error||h("common.tryAgain")}`)}}catch(a){a?.message?.includes("Failed to fetch")||a?.message?.includes("ERR_CONNECTION_REFUSED")||(console.error("Error creating booking:",a),alert(h("booking.bookingFailed")))}}};return(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-6",children:h("booking.bookAppointment")}),(0,b.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-2",children:h("booking.chooseService")}),(0,b.jsxs)("select",{value:o||"",onChange:a=>p(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"",children:h("booking.selectService")}),i.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-2",children:h("booking.chooseStaff")}),(0,b.jsxs)("select",{value:q||"",onChange:a=>r(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"",children:h("booking.selectStaff")}),k.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.first_name," ",a.last_name]},a.id))]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-2",children:h("booking.chooseDate")}),(0,b.jsx)("input",{type:"date",value:s||"",onChange:a=>{t(a.target.value)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)("button",{onClick:U,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:h("booking.checkAvailability")})}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-2",children:h("booking.chooseTimeslot")}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:m.map(a=>(0,b.jsxs)("button",{onClick:()=>alert(h("booking.timeslotSelected")),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:[a.start_time," - ",a.end_time]},a.id))})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-2",children:h("booking.yourInformation")}),(0,b.jsx)("input",{type:"text",placeholder:h("booking.yourName"),value:u,onChange:a=>v(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg mb-2"}),(0,b.jsx)("input",{type:"email",placeholder:h("booking.yourEmail"),value:w,onChange:a=>x(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),(0,b.jsx)("button",{onClick:V,className:"w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:h("booking.submit")})]}),N&&P&&(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4 text-center",children:"LINEã§äºˆç´„ / LINE ã§ãŠå•ã„åˆã‚ã›"}),(0,b.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[N&&(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("img",{src:N,alt:"LINE QR Code",className:"w-48 h-48 border-2 border-gray-200 rounded-lg"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600 text-center",children:"LINEã§äºˆç´„ã¯ã“ã¡ã‚‰"})]}),P&&(0,b.jsx)("a",{href:P,target:"_blank",rel:"noopener noreferrer",className:"px-6 py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors",children:"LINEã§äºˆç´„ã¯ã“ã¡ã‚‰"})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden flex flex-col h-[600px]",children:[(0,b.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50 flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Chat with AI Assistant"}),(0,b.jsx)("button",{onClick:()=>I(!H),className:"text-gray-600 hover:text-gray-900",children:H?"âˆ’":"+"})]}),H&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:0===B.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ¤–"}),(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Start a conversation"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Ask me anything about booking! I can help with appointments, availability, and more."})]})}):(0,b.jsxs)(b.Fragment,{children:[B.map(a=>{let c;return(0,b.jsxs)("div",{className:`flex gap-3 ${"customer"===a.senderType?"justify-end":"justify-start"}`,children:["customer"!==a.senderType&&(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)("span",{className:"text-lg",children:"ai"===a.senderType?"ðŸ¤–":"ðŸ‘¤"})}),(0,b.jsxs)("div",{className:`max-w-[75%] rounded-lg px-4 py-3 ${"customer"===a.senderType?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"}`,children:[(0,b.jsx)("p",{className:"whitespace-pre-wrap break-words",children:a.content}),(0,b.jsx)("p",{className:`text-xs mt-2 ${"customer"===a.senderType?"text-blue-100":"text-gray-500"}`,children:(c=new Date(a.createdAt),new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit"}).format(c))})]}),"customer"===a.senderType&&(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-600",children:"You"})})]},a.id)}),F&&(0,b.jsxs)("div",{className:"flex gap-3 justify-start",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)("span",{className:"text-lg",children:"ðŸ¤–"})}),(0,b.jsx)("div",{className:"bg-gray-100 rounded-lg px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,b.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),(0,b.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})]}),(0,b.jsx)("div",{ref:J})]})}),(0,b.jsx)("div",{className:"px-6 py-4 border-t border-gray-200",children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),T()},className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",value:D,onChange:a=>E(a.target.value),placeholder:"Type your message...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",disabled:F}),(0,b.jsx)("button",{type:"submit",disabled:!D.trim()||F,className:"px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]})})]})]})]})]})}a.s(["default",()=>g])}];

//# sourceMappingURL=apps_dashboard_app_book_%5BshopId%5D_page_tsx_29282e0b._.js.map