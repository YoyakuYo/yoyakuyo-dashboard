(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,20003,e=>{"use strict";e.i(47167);var t=e.i(43476),a=e.i(71645),s=e.i(63611),l=e.i(18566),r=e.i(48148);function i({title:e,value:a,change:s,changeLabel:l,icon:r,subtitle:i}){let d=void 0!==s?s>=0?"text-green-600":"text-red-600":"text-gray-600";return(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:e}),r&&(0,t.jsx)("div",{className:"text-gray-400",children:r})]}),(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:a}),void 0!==s&&(0,t.jsxs)("span",{className:`text-sm font-medium ${d}`,children:[s>=0?"+":"",s,"%"]})]}),l&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:l}),i&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:i})]})}function d({data:e,xLabel:a,yLabel:s,height:l=200,color:r="#3B82F6"}){if(!e||0===e.length)return(0,t.jsx)("div",{className:"flex items-center justify-center text-gray-500",style:{height:l},children:"No data available"});let i=l-80,d=Math.max(...e.map(e=>e.y),1),n=Math.min(...e.map(e=>e.y),0),o=t=>t/(e.length-1||1)*520+40,c=e=>i-(e-n)/(d-n||1)*(i-40)+40,x=e.map((e,t)=>`${o(t)},${c(e.y)}`).join(" ");return(0,t.jsx)("div",{className:"w-full",children:(0,t.jsxs)("svg",{viewBox:`0 0 600 ${l}`,className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[[0,.25,.5,.75,1].map(e=>{let a=40+e*(i-40);return(0,t.jsx)("line",{x1:40,y1:a,x2:560,y2:a,stroke:"#E5E7EB",strokeWidth:"1"},e)}),(0,t.jsx)("polyline",{points:x,fill:"none",stroke:r,strokeWidth:"2"}),e.map((e,a)=>(0,t.jsx)("circle",{cx:o(a),cy:c(e.y),r:"4",fill:r},a)),a&&(0,t.jsx)("text",{x:300,y:l-10,textAnchor:"middle",className:"text-xs fill-gray-600",children:a}),s&&(0,t.jsx)("text",{x:15,y:l/2,textAnchor:"middle",className:"text-xs fill-gray-600",transform:`rotate(-90, 15, ${l/2})`,children:s})]})})}function n({data:e,height:a=200,showValues:s=!0}){if(!e||0===e.length)return(0,t.jsx)("div",{className:"flex items-center justify-center text-gray-500",style:{height:a},children:"No data available"});let l=Math.max(20,520/e.length-10),r=Math.max(...e.map(e=>e.value),1);return(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)("svg",{viewBox:`0 0 600 ${a}`,className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:e.map((e,i)=>{let d=e.value/r*(a-80),n=40+i*(l+10),o=a-40-d,c=e.color||"#3B82F6";return(0,t.jsxs)("g",{children:[(0,t.jsx)("rect",{x:n,y:o,width:l,height:d,fill:c,rx:"4"}),s&&e.value>0&&(0,t.jsx)("text",{x:n+l/2,y:o-5,textAnchor:"middle",className:"text-xs fill-gray-700 font-medium",children:e.value}),(0,t.jsx)("text",{x:n+l/2,y:a-10,textAnchor:"middle",className:"text-xs fill-gray-600",transform:`rotate(-45, ${n+l/2}, ${a-10})`,children:e.label})]},i)})})})}function o(){let{user:e,loading:o}=(0,s.useAuth)(),c=(0,l.useRouter)(),x=(0,r.useTranslations)(),m="http://localhost:3000",[h,g]=(0,a.useState)(null),[u,y]=(0,a.useState)(!0),[p,b]=(0,a.useState)("30"),[j,f]=(0,a.useState)(""),[v,N]=(0,a.useState)(""),[w,$]=(0,a.useState)(null),[k,S]=(0,a.useState)([]),[C,D]=(0,a.useState)([]),[_,B]=(0,a.useState)([]),[A,R]=(0,a.useState)(null),[P,M]=(0,a.useState)([]);(0,a.useEffect)(()=>{o||e?e&&E():c.push("/")},[e,o,c]),(0,a.useEffect)(()=>{h&&T()},[h,p,j,v]);let E=async()=>{try{let t=await fetch(`${m}/shops?owner_user_id=${e?.id}`,{headers:{"x-user-id":e?.id||""}});if(t.ok){let e=await t.json();e&&e.length>0&&g(e[0])}}catch(e){console.error("Error loading shop:",e)}finally{y(!1)}},T=async()=>{let t;if(!h)return;let{startDate:a,endDate:s}=(t=new Date().toISOString(),"custom"===p&&j&&v?{startDate:j,endDate:v}:{startDate:new Date("7"===p?Date.now()-6048e5:"90"===p?Date.now()-7776e6:Date.now()-2592e6).toISOString(),endDate:t});try{y(!0);let[t,l,r,i,d,n]=await Promise.all([fetch(`${m}/analytics/shop/${h.id}/overview?start_date=${a}&end_date=${s}`,{headers:{"x-user-id":e?.id||""}}),fetch(`${m}/analytics/shop/${h.id}/bookings?start_date=${a}&end_date=${s}&group_by=day`,{headers:{"x-user-id":e?.id||""}}),fetch(`${m}/analytics/shop/${h.id}/services?start_date=${a}&end_date=${s}`,{headers:{"x-user-id":e?.id||""}}),fetch(`${m}/analytics/shop/${h.id}/staff?start_date=${a}&end_date=${s}`,{headers:{"x-user-id":e?.id||""}}),fetch(`${m}/analytics/shop/${h.id}/customers?start_date=${a}&end_date=${s}`,{headers:{"x-user-id":e?.id||""}}),fetch(`${m}/analytics/shop/${h.id}/peak-hours?start_date=${a}&end_date=${s}`,{headers:{"x-user-id":e?.id||""}})]);if(t.ok){let e=await t.json();$(e)}if(l.ok){let e=await l.json();S(e)}if(r.ok){let e=await r.json();D(e)}if(i.ok){let e=await i.json();B(e)}if(d.ok){let e=await d.json();R(e)}if(n.ok){let e=await n.json();M(e)}}catch(e){console.error("Error loading analytics:",e)}finally{y(!1)}};return u&&!h?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("p",{className:"text-gray-500",children:x("common.loading")})}):h?(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:x("analytics.title")}),(0,t.jsx)("p",{className:"text-gray-600",children:h.name})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,t.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:[x("analytics.dateRange"),":"]}),(0,t.jsx)("button",{onClick:()=>b("7"),className:`px-4 py-2 rounded-md ${"7"===p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:x("analytics.last7Days")}),(0,t.jsx)("button",{onClick:()=>b("30"),className:`px-4 py-2 rounded-md ${"30"===p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:x("analytics.last30Days")}),(0,t.jsx)("button",{onClick:()=>b("90"),className:`px-4 py-2 rounded-md ${"90"===p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:x("analytics.last90Days")}),(0,t.jsx)("button",{onClick:()=>b("custom"),className:`px-4 py-2 rounded-md ${"custom"===p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:x("analytics.custom")}),"custom"===p&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"date",value:j,onChange:e=>f(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md"}),(0,t.jsx)("span",{children:"to"}),(0,t.jsx)("input",{type:"date",value:v,onChange:e=>N(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md"})]})]})}),w&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,t.jsx)(i,{title:x("analytics.bookings"),value:w.totalBookings,subtitle:x("analytics.averagePerDay")+": "+w.averageBookingsPerDay.toFixed(1)}),(0,t.jsx)(i,{title:x("analytics.revenue"),value:`\xa5${w.totalRevenue.toLocaleString()}`,subtitle:x("analytics.averagePerDay")+": Â¥"+w.averageRevenuePerDay.toFixed(0)}),(0,t.jsx)(i,{title:x("analytics.cancellationRate"),value:`${w.cancellationRate.toFixed(1)}%`}),(0,t.jsx)(i,{title:x("analytics.completedBookings"),value:w.completedBookings})]}),k.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:x("analytics.bookingTrends")}),(0,t.jsx)(d,{data:k.map(e=>({x:e.date,y:e.count})),height:300,xLabel:x("analytics.date"),yLabel:x("analytics.bookings")})]}),C.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:x("analytics.servicePopularity")}),(0,t.jsx)(n,{data:C.slice(0,10).map(e=>({label:e.serviceName,value:e.bookingCount})),height:300})]}),_.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:x("analytics.staffPerformance")}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:x("myShop.staff")}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:x("analytics.bookings")})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.staffName}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.bookingCount})]},e.staffId))})]})})]}),A&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:x("analytics.customerAnalytics")}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsx)(i,{title:x("analytics.newCustomers"),value:A.newCustomers}),(0,t.jsx)(i,{title:x("analytics.returningCustomers"),value:A.returningCustomers})]})]}),P.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:x("analytics.peakHours")}),(0,t.jsx)(n,{data:P.map(e=>({label:`${e.hour}:00`,value:e.bookingCount})),height:300})]})]}):(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,t.jsx)("p",{className:"text-gray-500",children:x("myShop.noShop")})})}e.s(["default",()=>o],20003)}]);