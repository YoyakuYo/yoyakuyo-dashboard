(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67812,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(22016),i=e.i(18566),r=e.i(48148);function l(e){if(!e)return"unknown";let s=e.toLowerCase();for(let[e,t]of Object.entries({chiyoda:"cities.chiyoda",chuo:"cities.chuo",minato:"cities.minato",shinjuku:"cities.shinjuku",bunkyo:"cities.bunkyo",taito:"cities.taito",sumida:"cities.sumida",koto:"cities.koto",shinagawa:"cities.shinagawa",meguro:"cities.meguro",ota:"cities.ota",setagaya:"cities.setagaya",shibuya:"cities.shibuya",nakano:"cities.nakano",suginami:"cities.suginami",toshima:"cities.toshima",kita:"cities.kita",arakawa:"cities.arakawa",itabashi:"cities.itabashi",nerima:"cities.nerima",adachi:"cities.adachi",katsushika:"cities.katsushika",edogawa:"cities.edogawa"}))if(s.includes(`${e}-ku`)||s.includes(`${e} ku`)||s.includes(`${e}åŒº`))return t;for(let s of[{pattern:/umeda|åŒ—åŒº/i,key:"cities.osaka_kita"},{pattern:/namba|é›£æ³¢/i,key:"cities.namba"},{pattern:/shinsaibashi|å¿ƒæ–Žæ©‹/i,key:"cities.shinsaibashi"},{pattern:/dotonbori|é“é “å €/i,key:"cities.dotonbori"},{pattern:/tennoji|å¤©çŽ‹å¯º/i,key:"cities.tennoji"},{pattern:/roppongi|å…­æœ¬æœ¨/i,key:"cities.roppongi"},{pattern:/ginza|éŠ€åº§/i,key:"cities.ginza"},{pattern:/akihabara|ç§‹è‘‰åŽŸ/i,key:"cities.akihabara"},{pattern:/harajuku|åŽŸå®¿/i,key:"cities.harajuku"},{pattern:/asakusa|æµ…è‰/i,key:"cities.asakusa"},{pattern:/omotesando|è¡¨å‚é“/i,key:"cities.omotesando"},{pattern:/ikebukuro|æ± è¢‹/i,key:"cities.ikebukuro"},{pattern:/ueno|ä¸Šé‡Ž/i,key:"cities.ueno"},{pattern:/yokohama|æ¨ªæµœ/i,key:"cities.yokohama"},{pattern:/osaka|å¤§é˜ª/i,key:"cities.osaka"},{pattern:/kyoto|äº¬éƒ½/i,key:"cities.kyoto"},{pattern:/sapporo|æœ­å¹Œ/i,key:"cities.sapporo"},{pattern:/fukuoka|ç¦å²¡/i,key:"cities.fukuoka"},{pattern:/nagoya|åå¤å±‹/i,key:"cities.nagoya"},{pattern:/kobe|ç¥žæˆ¸/i,key:"cities.kobe"},{pattern:/sendai|ä»™å°/i,key:"cities.sendai"},{pattern:/hiroshima|åºƒå³¶/i,key:"cities.hiroshima"}])if(s.pattern.test(e))return s.key;let t=e.match(/([^\s,]+)[-\s](ku|shi|city|åŒº|å¸‚)/i);if(t){let e=t[1].toLowerCase();return`cities.${e}`}let a=e.split(/[,\s]+/).filter(e=>e.length>2);return a.length>0?a[0].toLowerCase():"unknown"}function o(e,s){let t=e=>{try{let t=s(e);return t!==e?t:null}catch(e){return null}};if(e.startsWith("cities.")||e.startsWith("prefectures.")){let s=t(e);return s||(e.split(".").pop()||e).replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase())}let a=t(`cities.${e}`);return a||e.replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase()).trim()}let n=(e,s)=>{let t,a={barbershop:"categories.barbershop","beauty salon":"categories.beauty_salon",eyelash:"categories.eyelash","general salon":"categories.general_salon","hair salon":"categories.hair_salon","nail salon":"categories.nail_salon","spa & massage":"categories.spa_massage","spa and massage":"categories.spa_massage","dental clinic":"categories.dental_clinic","women's clinic":"categories.womens_clinic","hotels & ryokan":"categories.hotels_ryokan","restaurants & izakaya":"categories.restaurants_izakaya","spas, onsen & day-use bathhouses":"categories.spas_onsen_bathhouses","golf courses & practice ranges":"categories.golf_courses_ranges","private karaoke rooms":"categories.private_karaoke_rooms",unknown:"categories.unknown"}[t=e.toLowerCase().trim()]||`categories.${t.replace(/\s+/g,"_")}`;try{let t=s(a);return t!==a?t:e}catch(s){return e}};function c(){let e=(0,i.useSearchParams)(),c=(0,i.useRouter)(),d=(0,r.useTranslations)(),[h,u]=(0,t.useState)([]),[m,g]=(0,t.useState)([]),[p,x]=(0,t.useState)({}),[b,y]=(0,t.useState)(!0),[f,k]=(0,t.useState)(e.get("search")||""),[j,N]=(0,t.useState)(e.get("category_id")||null),[w,v]=(0,t.useState)(e.get("area")||null),[S,_]=(0,t.useState)(new Set),[E,C]=(0,t.useState)(new Set),A="http://localhost:3000",[$,R]=(0,t.useState)(f);(0,t.useEffect)(()=>{let e=setTimeout(()=>{R(f)},500);return()=>clearTimeout(e)},[f]),(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch(`${A}/categories`);if(e.ok){let s=e.headers.get("content-type");if(s&&s.includes("application/json")){let s=await e.json();g(Array.isArray(s)?s:[])}}}catch(e){e?.message?.includes("Failed to fetch")||e?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error fetching categories:",e),g([])}})()},[A]),(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch(`${A}/categories/stats`);if(e.ok){let s=e.headers.get("content-type");if(s&&s.includes("application/json")){let s=await e.json();s&&"object"==typeof s&&!Array.isArray(s)&&x(s)}}}catch(e){e?.message?.includes("Failed to fetch")||e?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error fetching category stats:",e),x({})}})()},[A]);let I=(0,t.useCallback)(async()=>{try{y(!0);let e=new URLSearchParams;$.trim()&&e.set("search",$.trim()),j&&"all"!==j&&e.set("category_id",j);let s=await fetch(`${A}/shops${e.toString()?`?${e.toString()}`:""}`);if(s.ok){let e=s.headers.get("content-type");if(e&&e.includes("application/json")){let e=await s.json(),t=Array.isArray(e)?e.filter(e=>!e.claim_status||"hidden"!==e.claim_status):[];u(t)}}}catch(e){e?.message?.includes("Failed to fetch")||e?.message?.includes("ERR_CONNECTION_REFUSED")||console.error("Error fetching shops:",e),u([])}finally{y(!1)}},[A,$,j]);(0,t.useEffect)(()=>{I()},[I]),(0,t.useEffect)(()=>{let e=new URLSearchParams;$&&e.set("search",$),j&&"all"!==j&&e.set("category_id",j),w&&e.set("area",w);let s=`/browse${e.toString()?`?${e.toString()}`:""}`;c.replace(s,{scroll:!1})},[$,j,w,c]);let T=(0,t.useMemo)(()=>{let e=new Map;(w?h.filter(e=>{let s=l(e.address);return o(s,d)===w||s===w}):h).forEach(s=>{let t=s.category_id||"unknown";s.categories?.name;let a=l(s.address);e.has(t)||e.set(t,new Map);let i=e.get(t);i.has(a)||i.set(a,[]),i.get(a).push(s)});let s=[];return e.forEach((e,t)=>{let a=Array.from(e.values())[0]?.[0],i=a?.categories?.name||"Unknown",r=Array.from(e.entries()).map(([e,s])=>({areaName:o(e,d),areaKey:e,shops:s,count:s.length})).sort((e,s)=>s.count-e.count),l=r.reduce((e,s)=>e+s.count,0);s.push({categoryId:t,categoryName:i,areas:r,totalShops:l})}),s.sort((e,s)=>s.totalShops-e.totalShops),s},[h,w]);(0,t.useEffect)(()=>{let e=new Set;T.forEach(s=>{s.totalShops>0&&e.add(s.categoryId)}),_(e)},[T]);let U=e=>{N(e),v(null)},F=()=>{v(null)},O=(0,t.useMemo)(()=>w?h.filter(e=>{let s=l(e.address);return o(s,d)===w||s===w}):h,[h,w,d]);return(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8",children:[(0,s.jsx)("aside",{className:"w-full lg:w-64 flex-shrink-0",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6 sticky top-24",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:d("shops.search")}),(0,s.jsx)("input",{type:"text",value:f,onChange:e=>k(e.target.value),placeholder:d("shops.searchPlaceholder"),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),w&&(0,s.jsx)("div",{className:"mb-6 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:d("shops.filteredByArea")}),(0,s.jsx)("p",{className:"text-sm font-semibold text-blue-700",children:w})]}),(0,s.jsx)("button",{onClick:F,className:"text-blue-600 hover:text-blue-800 text-sm font-medium",title:d("shops.clearAreaFilter"),children:"âœ•"})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:d("shops.categories")}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("button",{onClick:()=>U(null),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${!j||"all"===j?"bg-blue-100 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-100"}`,children:[d("categories.all")," (",p.all||0,")"]}),m.map(e=>(0,s.jsxs)("button",{onClick:()=>U(e.id),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${j===e.id?"bg-blue-100 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-100"}`,children:[n(e.name,d)," (",p[e.id]||0,")"]},e.id))]})]})]})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:d("shops.shops")}),(0,s.jsx)("p",{className:"text-gray-600",children:b?d("shops.loading"):d("shops.shopsFound",{count:O.length})})]}),b?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:d("shops.loading")})]}):w?0===O.length?(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"ðŸª"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:d("shops.noShops")}),(0,s.jsxs)("p",{className:"text-gray-600 mb-4",children:[d("shops.noShops")," ",d("shops.inAreas",{count:1})," ",w]}),(0,s.jsx)("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:d("shops.clearAreaFilter")})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.map(e=>(0,s.jsxs)(a.default,{href:`/shops/${e.id}`,className:"bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow",children:[e.image_url&&(0,s.jsx)("div",{className:"w-full h-48 overflow-hidden bg-gray-100",children:(0,s.jsx)("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:e.name}),e.categories&&(0,s.jsx)("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded",children:n(e.categories.name,d)})]}),e.description&&(0,s.jsx)("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:((e,s=120)=>e?e.length<=s?e:e.substring(0,s)+"...":"")(e.description,100)}),(0,s.jsx)("p",{className:"text-gray-500 text-sm mb-4",children:e.address}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)("span",{className:"inline-block px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded-lg",children:[d("shops.viewDetails")," â†’"]})})]})]},e.id))}):0===T.length?(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"ðŸª"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:d("shops.noShops")}),(0,s.jsx)("p",{className:"text-gray-600",children:f||j?d("shops.tryAdjusting"):d("shops.notAvailable")})]}):(0,s.jsx)("div",{className:"space-y-8",children:T.map(e=>{let t=S.has(e.categoryId),a=e.areas.length<=10;return(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[(0,s.jsx)("button",{onClick:()=>{var s;let t;return s=e.categoryId,void((t=new Set(S)).has(s)?t.delete(s):t.add(s),_(t))},className:"w-full px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 transition-colors flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:t?"â–¼":"â–¶"}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:n(e.categoryName,d)}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:d("shops.shopsInAreas",{shops:e.totalShops,areas:e.areas.length})})]})]})}),t&&(0,s.jsxs)("div",{className:"p-6 space-y-4",children:[(a||E.has(e.categoryId)?e.areas:e.areas.slice(0,10)).map(e=>(0,s.jsx)("div",{className:"border-l-4 border-blue-500 pl-4",children:(0,s.jsx)("button",{onClick:()=>{v(e.areaName)},className:"w-full text-left group hover:bg-blue-50 p-3 rounded-lg transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-700",children:e.areaName}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[e.count," ",1!==e.count?d("shops.shops"):d("shops.shop")]})]}),(0,s.jsx)("span",{className:"text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity",children:"View â†’"})]})})},e.areaName)),!a&&(0,s.jsx)("button",{onClick:()=>{let s=new Set(E);s.has(e.categoryId)?s.delete(e.categoryId):s.add(e.categoryId),C(s)},className:"w-full text-center py-2 text-blue-600 hover:text-blue-800 font-medium text-sm",children:E.has(e.categoryId)?d("shops.showLess",{hidden:e.areas.length-10}):d("shops.seeAllAreas",{count:e.areas.length})})]})]},e.categoryId)})})]})]})}function d(){let e=(0,r.useTranslations)();return(0,s.jsx)(t.Suspense,{fallback:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:e("common.loading")})]})}),children:(0,s.jsx)(c,{})})}e.s(["default",()=>d])}]);